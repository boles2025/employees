<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ØªØµÙ…ÙŠÙ… Ù…Ù‡Ù†Ø¯Ø³ Ø¨ÙˆÙ„Ø³ Ø³Ù…ÙŠØ±</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">

    <style>
        :root {
            /*
             * ØªÙ… ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„ØªÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ø­ÙŠÙˆÙŠØ© ÙˆØªÙ†ÙˆØ¹Ø§Ù‹.
             * Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªØ¹Ø·ÙŠ Ù…Ø¸Ù‡Ø±Ù‹Ø§ Ø¬Ø°Ø§Ø¨Ù‹Ø§ ÙˆÙ…ØªØºÙŠØ±Ù‹Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
             * ÙƒÙ…Ø§ ØªØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø´Ø§Ø´Ø§Øª ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©.
             */
            --primary: #0072b5;       /* Ø£Ø²Ø±Ù‚ ØºÙ†ÙŠ */
            --primary-light: #00a3e0; /* ØªØ±ÙƒÙˆØ§Ø² ÙØ§ØªØ­ */
            --secondary: #8e44ad;     /* Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ */
            --secondary-dark: #6c3483;/* Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ ØºØ§Ù…Ù‚ */
            --accent: #e74c3c;        /* Ø£Ø­Ù…Ø± Ø²Ø§Ù‡ÙŠ */
            --accent-light: #f39c12;  /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
            --bg: #fdf6e3;            /* Ø¨ÙŠØ¬ ÙØ§ØªØ­ */
            --bg-gradient: linear-gradient(135deg, #fdf6e3 0%, #efe8d8 100%);
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
            --hover-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
            --transition: all 0.4s ease;
        }
        
        * {
            transition: var(--transition);
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: var(--bg-gradient);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .navbar {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 15px 0;
            backdrop-filter: blur(10px);
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
        }
        
        .main-card {
            border: none;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            background: white;
            padding: 30px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--accent) 100%);
        }
        
        .main-card:hover {
            box-shadow: var(--hover-shadow);
            transform: translateY(-5px);
        }
        
        .swapped-row {
            background: linear-gradient(90deg, #fff9e6 0%, #fff3cd 100%) !important;
            border-right: 5px solid var(--accent-light);
            position: relative;
        }
        
        /*
         * Ù‚Ù…Ù†Ø§ Ø¨Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ÙˆÙ‡Ù…ÙŠ (::before) Ù…Ù† Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªÙ‰ ØªÙ… ØªØ¨Ø§Ø¯Ù„Ù‡Ø§ Ù„Ø£Ù† ÙˆØ¬ÙˆØ¯Ù‡
         * ÙƒØ§Ù† ÙŠØ³Ø¨Ø¨ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù†Ø§Ø­ÙŠØ© Ø§Ù„ÙŠÙ…ÙŠÙ† Ù…Ù…Ø§ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØ¸Ù‡Ø± ØªØ­Øª Ø£Ø¹Ù…Ø¯Ø©
         * ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…. Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ø¨Ø± pseudo-element
         * ÙŠÙ…ÙƒÙ† ØªÙ…ÙŠÙŠØ² Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ ÙÙ‚Ø·.
         */
        .swapped-row::before {
            display: none;
        }
        
        #adminDashboardView {
            background-color: #f1f5f9;
            min-height: 100vh;
            display: none;
        }
        
        .admin-sidebar {
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            min-height: 100vh;
            padding-top: 20px;
            box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .admin-nav-link {
            color: rgba(255, 255, 255, 0.85);
            padding: 14px 20px;
            display: block;
            text-decoration: none;
            border-radius: 10px;
            margin: 5px 10px;
            position: relative;
            overflow: hidden;
        }
        
        .admin-nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.2) 100%);
            transition: var(--transition);
        }
        
        .admin-nav-link:hover::before,
        .admin-nav-link.active::before {
            right: 0;
        }
        
        .admin-nav-link:hover,
        .admin-nav-link.active {
            background: rgba(26, 188, 156, 0.2);
            color: white;
            transform: translateX(-5px);
        }
        
        .request-card {
            border-left: 6px solid #ddd;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .request-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.8) 100%);
            transform: translateX(100%);
            transition: transform 0.5s ease;
        }
        
        .request-card:hover::after {
            transform: translateX(0);
        }
        
        .request-card:hover {
            transform: translateY(-7px) scale(1.01);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .status-pending {
            border-left-color: var(--accent-light);
        }
        
        .status-approved {
            border-left-color: var(--secondary);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            border: none;
            border-radius: 10px;
            padding: 10px 25px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background: linear-gradient(90deg, var(--primary-light) 0%, var(--primary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(44, 62, 80, 0.2);
        }
        
        .btn-success {
            background: linear-gradient(90deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            border: none;
            border-radius: 10px;
            padding: 10px 25px;
            font-weight: 600;
        }
        
        .btn-success:hover {
            background: linear-gradient(90deg, var(--secondary-dark) 0%, var(--secondary) 100%);
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(26, 188, 156, 0.2);
        }
        
        .btn-warning {
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%);
            border: none;
            border-radius: 10px;
            padding: 10px 25px;
            font-weight: 600;
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(90deg, var(--accent-light) 0%, var(--accent) 100%);
            transform: translateY(-2px);
            box-shadow: 0 7px 15px rgba(230, 126, 34, 0.2);
        }
        
        .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            font-size: 1rem;
        }
        
        .form-control:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 0.25rem rgba(26, 188, 156, 0.25);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease forwards;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        #loadingOverlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .loader {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .table {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .table thead th {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            padding: 15px;
            font-weight: 600;
        }
        
        .table tbody tr {
            border-bottom: 1px solid #f1f1f1;
        }

        /* Ø¥Ø¶Ø§ÙØ© ØªØ¨Ø§ÙŠÙ† Ø¨Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨ÙŠÙ† Ø§Ù„ØµÙÙˆÙ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© */
        .table tbody tr:nth-child(odd) {
            background-color: rgba(243, 156, 18, 0.05); /* Ù„ÙˆÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ÙØ§ØªØ­ */
        }
        .table tbody tr:nth-child(even) {
            background-color: rgba(142, 68, 173, 0.05); /* Ù„ÙˆÙ† Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ ÙØ§ØªØ­ */
        }

        .table tbody tr:hover {
            background-color: rgba(231, 76, 60, 0.1); /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± ÙØ§ØªØ­ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± */
        }
        
        .designer-footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px solid #eee;
            text-align: center;
            font-weight: bold;
            /* Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ ÙƒÙˆÙ†Ù‡ Ù„ÙˆÙ†Ø§Ù‹ Ø«Ø§Ù†ÙˆÙŠØ§Ù‹ Ù„Ø¬Ø°Ø¨ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ */
            color: var(--secondary);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Ø´Ø±ÙŠØ· Ø´ÙƒØ± Ù…ØªØ­Ø±Ùƒ Ù„Ø¬Ø°Ø¨ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ */
        .thank-you-banner {
            width: 100%;
            overflow: hidden;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            color: #fff;
            padding: 8px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 1050;
            font-weight: bold;
            text-align: center;
        }
        .thank-you-banner span {
            display: inline-block;
            padding-left: 100%;
            white-space: nowrap;
            animation: marquee 15s linear infinite;
        }
        @keyframes marquee {
            0%   { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }

        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„ÙŠØ¸Ù‡Ø± ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø´ÙƒÙ„ Ø«Ø§Ø¨Øª */
        @media print {
            .thank-you-banner {
                position: static;
                background: transparent;
                color: var(--secondary);
                padding: 8px 0;
            }
            .thank-you-banner span {
                animation: none;
                padding-left: 0;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #adminDashboardView, #adminDashboardView * {
                visibility: visible;
            }
            
            .no-print, .no-print * {
                display: none !important;
            }
            
            .admin-sidebar {
                display: none !important;
            }
            
            .col-md-10 {
                width: 100% !important;
                margin-right: 0 !important;
                margin-left: 0 !important;
                padding: 0 !important;
            }
            
            .main-card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                padding: 15px !important;
                margin: 0 !important;
                width: 100% !important;
            }
            
            #masterReportArea table {
                font-size: 10px !important;
                width: 100% !important;
            }
            
            #masterReportArea th,
            #masterReportArea td {
                padding: 4px 6px !important;
                font-size: 9px !important;
            }
            
            @page {
                size: A4 landscape;
                margin: 0.5cm;
            }
            
            body {
                margin: 0;
                padding: 0;
            }
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 5px 20px rgba(26, 188, 156, 0.4);
            cursor: pointer;
            z-index: 100;
            animation: pulse 2s infinite;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .stats-card i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .stats-card .number {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .stats-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .progress-container {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--accent) 100%);
            border-radius: 5px;
            transition: width 1s ease;
        }
        
        .tab-content {
            padding: 20px;
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .nav-tabs {
            border-bottom: 2px solid #dee2e6;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: var(--primary);
            font-weight: 600;
            padding: 12px 25px;
            border-radius: 10px 10px 0 0;
            margin-left: 5px;
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù… */
        #masterReportArea table {
            font-size: 12px;
        }
        
        #masterReportArea th {
            font-size: 11px;
            padding: 8px 5px;
            white-space: nowrap;
        }
        
        #masterReportArea td {
            font-size: 11px;
            padding: 6px 4px;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        #scheduleTableBody td {
            padding: 12px 8px;
            vertical-align: middle;
            font-size: 14px;
        }
        
        #scheduleTableBody .badge {
            font-size: 12px;
            padding: 5px 8px;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØµÙˆØ±Ø© */
        .schedule-for-capture {
            padding: 20px;
            background: white;
            color: #000 !important;
        }
        
        .schedule-for-capture table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .schedule-for-capture th {
            background: #005f73;
            color: white;
            padding: 10px;
            text-align: center;
        }
        
        .schedule-for-capture td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
            color: #000 !important;
        }
        
        .schedule-for-capture .swapped-row-capture {
            background-color: #fff3cd;
            color: #000 !important;
        }
        
        @media (max-width: 768px) {
            .main-card {
                padding: 20px;
            }
            
            .navbar-brand {
                font-size: 1.2rem;
            }
            
            .floating-action-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                bottom: 20px;
                left: 20px;
            }
            
            #masterReportArea table {
                font-size: 10px;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        .schedule-table-container {
            overflow-x: auto;
        }
        
        .schedule-table {
            min-width: 800px;
        }
        
        .schedule-table th:nth-child(1),
        .schedule-table td:nth-child(1) {
            width: 120px;
        }
        
        .schedule-table th:nth-child(2),
        .schedule-table td:nth-child(2) {
            width: 100px;
        }
        
        .schedule-table th:nth-child(3),
        .schedule-table td:nth-child(3) {
            width: 100px;
        }
        
        .schedule-table th:nth-child(4),
        .schedule-table td:nth-child(4) {
            width: 150px;
        }
        
        .schedule-table th:nth-child(5),
        .schedule-table td:nth-child(5) {
            width: 80px;
        }
    </style>
</head>
<body>

    <div id="loadingOverlay" class="animate__animated animate__fadeIn">
        <div class="loader"></div>
        <p class="mt-3 text-white fw-bold fs-5 animate__animated animate__pulse animate__infinite">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
    </div>

    <div id="userInterface" style="display: none;">
        <nav class="navbar navbar-dark sticky-top animate__animated animate__fadeInDown">
            <div class="container">
                <a class="navbar-brand fw-bold"><i class="fas fa-clipboard-check me-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªØµÙ…ÙŠÙ… Ù…Ù‡Ù†Ø¯Ø³ Ø¨ÙˆÙ„Ø³ Ø³Ù…ÙŠØ±</a>
                <div class="d-flex align-items-center no-print">
                    <div class="position-relative me-3" style="cursor:pointer" onclick="showNotifications()">
                        <i class="fas fa-bell text-white fa-lg"></i>
                        <span id="notifBadge" class="notification-badge" style="display:none">0</span>
                    </div>
                    <button class="btn btn-outline-light btn-sm ms-3" style="font-weight:600;" onclick="showAdminLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
                </div>
            </div>
        </nav>

        <div class="container py-4">
            <div id="searchSection" class="main-card text-center animate__animated animate__fadeInUp">
                <h3 class="mb-4 text-primary fw-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ù…Ø±Ù‚Ø¨Ø§Øª</h3>
                <p class="text-muted mb-4">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</p>
                <div class="input-group mb-3 mx-auto shadow-sm" style="max-width: 500px;">
                    <input type="text" id="nidInput" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ">
                    <button class="btn btn-primary px-4" onclick="searchEmployee()"><i class="fas fa-search me-2"></i>Ø¨Ø­Ø«</button>
                </div>
                <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm" onclick="showHelp()"><i class="fas fa-question-circle me-1"></i>ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                </div>
            </div>

            <div id="empDashboard" class="main-card d-none animate__animated animate__fadeInUp">
                <div id="captureArea">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h4 id="displayName" class="text-primary fw-bold mb-1"></h4>
                            <small class="text-muted" id="displayId"></small>
                            <div class="mt-2">
                                <!--
                                    ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù†Øµ "ÙŠÙˆÙ… Ø¹Ù…Ù„" ÙˆØ°Ù„Ùƒ ÙˆÙÙ‚ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ
                                    Ù„ØªØ¹ÙƒØ³ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªÙŠ ÙŠØ´Ø±Ù ÙÙŠÙ‡Ø§ Ø§Ù„Ù…ÙˆØ¸Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª.
                                -->
                                <span class="badge bg-success" id="workDaysCount">0 Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span>
                                <span class="badge bg-warning mx-2" id="swapDaysCount">0 ØªØ¨Ø¯ÙŠÙ„</span>
                            </div>
                        </div>
                        <div class="no-print d-flex gap-2">
                            <button class="btn btn-success btn-sm" onclick="downloadSchedule()"><i class="fas fa-image me-1"></i> Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                            <button class="btn btn-warning btn-sm fw-bold" onclick="openSwapRequest()"><i class="fas fa-exchange-alt me-1"></i> Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„</button>
                            <button class="btn btn-outline-primary btn-sm" onclick="showEmpDetails()"><i class="fas fa-info-circle me-1"></i> Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                        </div>
                    </div>

                    <div class="progress-container">
                        <div id="workProgress" class="progress-bar" style="width: 0%"></div>
                    </div>
                    <!-- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ Ù„ÙŠØ¹ÙƒØ³ Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„ -->
                    <div class="small text-muted text-center mb-3">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ </div>

                    <div class="schedule-table-container">
                        <table class="table table-bordered text-center align-middle schedule-table">
                            <thead class="table-light">
                                <tr>
                                    <!-- ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø­ÙŠØ« ÙŠØ¸Ù‡Ø± Ø§Ù„ÙŠÙˆÙ… Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø«Ù… Ø§Ù„Ø­Ø§Ù„Ø© -->
                                    <th width="100">Ø§Ù„ÙŠÙˆÙ…</th>
                                    <th width="120">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th width="100">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th width="150">Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                    <th width="80" class="no-print">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleTableBody"></tbody>
                        </table>
                    </div>
                    
                    <div class="designer-footer show-on-capture" style="display:none;">
                        <!-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ù„ÙŠØ¹ÙƒØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø°Ø§Ø¨ ÙˆØ§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
                        <!-- Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ± Ø®Ø§ØµØ© ØªØ¸Ù‡Ø± Ø£Ø³ÙÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
                        Ø´ÙƒØ± Ø®Ø§Øµ Ù„Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¨ÙˆÙ„Ø³ Ø³Ù…ÙŠØ±ØŒ Ù…Ø¯ÙŠØ± ÙˆØ­Ø¯Ø© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨ÙƒÙ„ÙŠØ© Ø§Ù„Ø·Ø¨ Ø§Ù„Ø¨ÙŠØ·Ø±ÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù†ÙŠØ§
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="adminDashboardView">
        <div class="floating-action-btn no-print animate__animated animate__fadeInUp" onclick="showQuickActions()">
            <i class="fas fa-bolt"></i>
        </div>
        
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-2 admin-sidebar no-print">
                    <div class="text-center mb-4 pt-3">
                        <div class="position-relative d-inline-block">
                            <i class="fas fa-user-shield fa-3x mb-2 text-white-50"></i>
                            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-success border border-light rounded-circle">
                                <span class="visually-hidden">Ù†Ø´Ø·</span>
                            </span>
                        </div>
                        <h5 class="fw-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h5>
                        <small class="text-white-50" id="adminWelcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</small>
                    </div>
                    <nav class="nav flex-column">
                        <a class="admin-nav-link active" href="#" onclick="switchAdminTab('adm1', this)"><i class="fas fa-users me-2"></i> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a>
                        <a class="admin-nav-link" href="#" onclick="switchAdminTab('adm2', this)"><i class="fas fa-calendar-alt me-2"></i> Ø§Ù„ØªÙˆØ²ÙŠØ¹</a>
                        <a class="admin-nav-link" href="#" onclick="switchAdminTab('adm3', this)"><i class="fas fa-sync me-2"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¨Ø¯ÙŠÙ„</a>
                        <a class="admin-nav-link" href="#" onclick="switchAdminTab('adm4', this)"><i class="fas fa-file-invoice me-2"></i> Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù…</a>
                        <a class="admin-nav-link" href="#" onclick="switchAdminTab('adm5', this)"><i class="fas fa-chart-pie me-2"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</a>
                        <hr class="bg-white mx-3">
                        <a class="admin-nav-link text-warning" href="#" onclick="logoutAdmin()"><i class="fas fa-sign-out-alt me-2"></i> Ø®Ø±ÙˆØ¬</a>
                    </nav>
                    
                    <div class="position-absolute bottom-0 start-0 end-0 p-3 text-center text-white-50 small">
                        v2.1.0
                    </div>
                </div>
                
                <div class="col-md-10 p-4">
                    <div id="adminContent">
                        <div id="adm1" class="admin-tab">
                            <div class="main-card mt-0">
                                <h5 class="fw-bold border-bottom pb-3 mb-4"><i class="fas fa-users me-2"></i>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h5>
                                
                                <div class="row g-3 mb-4 p-3 bg-light rounded">
                                    <div class="col-md-5">
                                        <label class="form-label fw-bold">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                        <input type="text" id="aName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</label>
                                        <input type="text" id="aId" class="form-control" placeholder="14 Ø±Ù‚Ù…">
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-success w-100 py-2" onclick="addManualEmployee()"><i class="fas fa-user-plus me-2"></i>Ø¥Ø¶Ø§ÙØ©</button>
                                    </div>
                                </div>
                                
                                <div class="row mb-3 p-3 bg-light rounded">
                                    <div class="col-12">
                                        <h6 class="fw-bold mb-3"><i class="fas fa-file-excel me-2 text-success"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ù…Ù„Ù Excel</h6>
                                        <div class="input-group">
                                            <input type="file" id="excelFileInput" class="form-control" accept=".xlsx,.xls">
                                            <button class="btn btn-primary" onclick="importFromExcel()"><i class="fas fa-upload me-1"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                                        </div>
                                        <small class="text-muted">ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ÙŠÙ†: "Ø§Ù„Ø§Ø³Ù…" Ùˆ "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ"</small>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="fw-bold m-0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h6>
                                    <div class="small text-muted" id="empCount">0 Ù…ÙˆØ¸Ù</div>
                                </div>
                                <div id="adminEmpsList" class="list-group" style="max-height: 500px; overflow-y: auto;"></div>
                            </div>
                        </div>

                        <div id="adm3" class="admin-tab d-none">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="main-card h-100">
                                        <h6 class="fw-bold mb-3"><i class="fas fa-clock text-warning me-2"></i>Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</h6>
                                        <div id="pendingSwapsList" class="mb-3" style="max-height: 400px; overflow-y: auto;"></div>
                                        <div class="text-center">
                                            <button class="btn btn-outline-warning btn-sm" onclick="refreshSwaps()"><i class="fas fa-sync me-1"></i>ØªØ­Ø¯ÙŠØ«</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="main-card h-100">
                                        <h6 class="fw-bold mb-3"><i class="fas fa-check-circle text-success me-2"></i>Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</h6>
                                        <div id="completedSwapsList" class="mb-3" style="max-height: 400px; overflow-y: auto;"></div>
                                        <div class="text-center">
                                            <button class="btn btn-outline-success btn-sm" onclick="exportSwaps()"><i class="fas fa-download me-1"></i>ØªØµØ¯ÙŠØ±</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="adm4" class="admin-tab d-none">
                            <div class="main-card mt-0">
                                <div class="d-flex justify-content-between mb-3 no-print">
                                    <h5 class="fw-bold"><i class="fas fa-file-invoice me-2"></i>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ù…Ø¬Ù…Ø¹</h5>
                                    <div>
                                        <button class="btn btn-dark me-2" onclick="window.print()"><i class="fas fa-print me-1"></i> Ø·Ø¨Ø§Ø¹Ø©</button>
                                        <button class="btn btn-success" onclick="exportMasterReport()"><i class="fas fa-file-excel me-1"></i> ØªØµØ¯ÙŠØ± Excel</button>
                                    </div>
                                </div>
                                <div id="masterReportArea" style="overflow-x: auto;"></div>
                            </div>
                        </div>

                        <div id="adm5" class="admin-tab d-none">
                            <div class="main-card mt-0">
                                <h5 class="fw-bold border-bottom pb-3 mb-4"><i class="fas fa-chart-pie me-2"></i>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <canvas id="statsChart" height="250"></canvas>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="p-3 bg-light rounded">
                                            <h6 class="fw-bold">Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹</h6>
                                            <div id="statsSummary" class="mt-3"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="adm2" class="admin-tab d-none">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="main-card mt-0 h-100">
                                        <h5 class="fw-bold mb-3"><i class="fas fa-calendar me-2"></i>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</h5>
                                        <div class="input-group mb-3">
                                            <input type="date" id="newDate" class="form-control">
                                            <button class="btn btn-primary" onclick="addDate()"><i class="fas fa-plus"></i></button>
                                        </div>
                                        <div class="mb-3">
                                            <button class="btn btn-outline-secondary btn-sm w-100 mb-2" onclick="addMultipleDates()"><i class="fas fa-calendar-plus me-1"></i>Ø¥Ø¶Ø§ÙØ© Ù†Ø·Ø§Ù‚ ØªÙˆØ§Ø±ÙŠØ®</button>
                                        </div>
                                        <h6 class="fw-bold mt-4">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¶Ø§ÙØ©</h6>
                                        <div id="adminDatesList" class="d-flex flex-wrap gap-2 mt-3" style="max-height: 200px; overflow-y: auto;"></div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="main-card mt-0">
                                        <h5 class="fw-bold mb-3"><i class="fas fa-user-check me-2"></i>Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹</h5>
                                        <div class="input-group mb-3">
                                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                                            <input type="text" id="assignSearch" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸Ù..." onkeyup="filterAssignSearch()">
                                        </div>
                                        <div id="assignSearchResults" class="list-group" style="max-height: 400px; overflow-y: auto;"></div>
                                        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹: ÙŠØ¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø¹ÙŠÙ†Ø© Ø¨Ø¹Ù„Ø§Ù…Ø© ØµØ­ -->
                                        <div id="assignmentOverview" class="mt-4"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loginModal" class="d-none position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-75" style="z-index:10000">
        <div class="d-flex align-items-center justify-content-center h-100">
            <div class="main-card mx-auto animate__animated animate__zoomIn" style="max-width:400px">
                <div class="text-center mb-4">
                    <i class="fas fa-lock fa-3x text-primary mb-3"></i>
                    <h5 class="fw-bold">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h5>
                    <p class="text-muted small">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
                </div>
                <input type="password" id="adminPass" class="form-control my-3 text-center py-3" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <button class="btn btn-dark w-100 py-2" onclick="checkAdmin()"><i class="fas fa-sign-in-alt me-2"></i>Ø¯Ø®ÙˆÙ„</button>
                <div class="text-center mt-3">
                    <button class="btn btn-link text-muted small" onclick="hideLoginModal()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
    </div>

    <div id="quickActionsModal" class="d-none position-fixed bottom-0 start-0 w-100" style="z-index:9990">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-4">
                    <div class="main-card animate__animated animate__slideInUp">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="fw-bold m-0">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h6>
                            <button class="btn btn-sm btn-outline-secondary" onclick="hideQuickActions()"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="list-group">
                            <a href="#" class="list-group-item list-group-item-action" onclick="exportMasterReport()"><i class="fas fa-file-excel me-2"></i>ØªØµØ¯ÙŠØ± Excel</a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="window.print()"><i class="fas fa-print me-2"></i>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="refreshSwaps()"><i class="fas fa-sync me-2"></i>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="showHelp()"><i class="fas fa-question-circle me-2"></i>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBbslcuBI0eXaidzuAL4gqtyiWv48tp7ME",
            authDomain: "gradusum.firebaseapp.com",
            databaseURL: "https://gradusum-default-rtdb.firebaseio.com",
            projectId: "gradusum",
            // ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ø³Ù… Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù„ÙŠØ¹Ù…Ù„ Ù…Ø¹ Firebase Storage Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            storageBucket: "gradusum.appspot.com",
            messagingSenderId: "869226902808",
            appId: "1:869226902808:web:ae22f03cc9f2a7a796da6d",
            measurementId: "G-MS9FPE6HZW"
        };

        let db, auth, currentEmpData, allEmployees = [], allDates = [], statsChart, firebaseInitialized = false;

        async function init() {
            try {
                console.log('ğŸš€ Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...');
                
                setTimeout(() => {
                    const loadingOverlay = document.getElementById('loadingOverlay');
                    if(loadingOverlay && loadingOverlay.style.display !== 'none') {
                        loadingOverlay.style.display = 'none';
                        document.getElementById('userInterface').style.display = 'block';
                        console.log('âœ… ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
                    }
                }, 2000);
                
                try {
                    if (typeof firebase === 'undefined') {
                        throw new Error('Firebase library not loaded');
                    }
                    
                    if (!firebase.apps.length) {
                        firebase.initializeApp(firebaseConfig);
                        console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ù†Ø¬Ø§Ø­');
                    } else {
                        firebase.app();
                        console.log('âœ… ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ·Ø¨ÙŠÙ‚ Firebase Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯');
                    }
                    
                    db = firebase.firestore();
                    
                    const settings = {
                        cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED,
                        ignoreUndefinedProperties: true
                    };
                    db.settings(settings);
                    
                    try {
                        await firebase.firestore().enablePersistence({
                            synchronizeTabs: true
                        });
                        console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª');
                    } catch (persistenceError) {
                        console.warn('âš ï¸ ØªØ¹Ø°Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª:', persistenceError.code);
                    }
                    
                    try {
                        auth = firebase.auth();
                        await auth.signInAnonymously();
                        console.log('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ');
                        
                        const currentUser = auth.currentUser;
                        if (currentUser) {
                            console.log('ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„:', currentUser.uid);
                        }
                    } catch (authError) {
                        console.warn('âš ï¸ ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ:', authError);
                    }
                    
                    firebaseInitialized = true;
                    
                    try {
                        console.log('ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                        
                        const testRef = db.collection('testConnection').doc('test');
                        const testDoc = await testRef.get();
                        
                        if (!testDoc.exists) {
                            await testRef.set({
                                timestamp: new Date().toISOString(),
                                message: 'Test connection successful',
                                app: 'Exam Management System'
                            });
                        }
                        
                        console.log('âœ… Ø§ØªØµØ§Ù„ Firestore ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
                        
                        await loadData();
                        
                    } catch (firestoreError) {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§ØªØµØ§Ù„ Firestore:', firestoreError);
                        
                        if (firestoreError.code === 'permission-denied') {
                            showErrorMessage('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª. ÙŠØ¬Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† ÙÙŠ Firebase Console.');
                        } else if (firestoreError.code === 'failed-precondition') {
                            showErrorMessage('Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…Ù‡ÙŠØ¦Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Firestore ÙÙŠ Ù…Ø´Ø±ÙˆØ¹Ùƒ.');
                        } else if (firestoreError.code === 'unavailable') {
                            console.log('ğŸŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„');
                            loadMockData();
                        } else {
                            console.error('âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ:', firestoreError);
                            showErrorMessage(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${firestoreError.message}`);
                            loadMockData();
                        }
                    }
                    
                } catch (firebaseError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Firebase:', firebaseError);
                    showErrorMessage('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase. ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„.');
                    
                    loadMockData();
                    
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').style.display = 'none';
                        document.getElementById('userInterface').style.display = 'block';
                    }, 1000);
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙØ§Ø¯Ø­:', error);
                showErrorMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…');
            }
        }

        async function loadData() {
            try {
                if (!firebaseInitialized) {
                    console.log('âš ï¸ Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¦ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
                    loadMockData();
                    return;
                }
                
                console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                
                try {
                    const employeesSnapshot = await db.collection('employees').get();
                    allEmployees = [];
                    employeesSnapshot.forEach(doc => {
                        const data = doc.data();
                        allEmployees.push({
                            id: doc.id,
                            nationalId: doc.id,
                            name: data.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                            schedule: data.schedule || [],
                            pendingSwaps: data.pendingSwaps || [],
                            notifications: data.notifications || [],
                            createdAt: data.createdAt || new Date().toISOString(),
                            lastUpdated: data.lastUpdated || new Date().toISOString()
                        });
                    });
                    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allEmployees.length} Ù…ÙˆØ¸Ù`);
                } catch (empError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', empError);
                    if (empError.code === 'permission-denied') {
                        console.error('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§ØªØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Firestore');
                        Swal.fire({
                            icon: 'error',
                            title: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª',
                            html: `
                                <div class="text-start">
                                    <p>ÙŠØ¬Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† ÙÙŠ Firebase Console:</p>
                                    <div style="text-align: left; direction: ltr; background: #f1f1f1; padding: 10px; border-radius: 5px; font-family: monospace; overflow: auto;">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
                                    </div>
                                    <p class="mt-3 small text-muted">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Ù‡Ø°Ø§ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙÙ‚Ø·. Ù‚Ù… Ø¨ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹.
                                    </p>
                                </div>
                            `,
                            width: 600
                        });
                    }
                    loadMockData();
                    return;
                }
                
                try {
                    const datesDoc = await db.collection('settings').doc('examDates').get();
                    if (datesDoc.exists) {
                        allDates = datesDoc.data().dates || [];
                        allDates.sort();
                        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allDates.length} ØªØ§Ø±ÙŠØ®`);
                    } else {
                        try {
                            await db.collection('settings').doc('examDates').set({ 
                                dates: [],
                                lastUpdated: new Date().toISOString()
                            });
                            allDates = [];
                            console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®');
                        } catch (dateError) {
                            console.warn('âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®:', dateError);
                        }
                    }
                } catch (dateLoadError) {
                    console.warn('âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®:', dateLoadError);
                    allDates = [];
                }
                
                renderAdminEmps();
                renderAdminDates();
                updateStats();
                
                if (currentEmpData) {
                    const updatedEmp = allEmployees.find(e => e.nationalId === currentEmpData.nationalId);
                    if (updatedEmp) {
                        currentEmpData = updatedEmp;
                        renderEmpUI();
                    }
                }
                
                saveToLocalStorage();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                loadMockData();
            }
        }

        function loadMockData() {
            console.log('ğŸ“‚ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
            
            const savedEmployees = localStorage.getItem('employees');
            const savedDates = localStorage.getItem('examDates');
            
            if (savedEmployees) {
                allEmployees = JSON.parse(savedEmployees);
                console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allEmployees.length} Ù…ÙˆØ¸Ù Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ`);
            } else {
                allEmployees = [
                    {
                        nationalId: "12345678901234",
                        name: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
                        schedule: [],
                        pendingSwaps: [],
                        notifications: [],
                        createdAt: new Date().toISOString(),
                        lastUpdated: new Date().toISOString()
                    },
                    {
                        nationalId: "98765432109876",
                        name: "Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ",
                        schedule: [],
                        pendingSwaps: [],
                        notifications: [],
                        createdAt: new Date().toISOString(),
                        lastUpdated: new Date().toISOString()
                    }
                ];
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
            }
            
            if (savedDates) {
                allDates = JSON.parse(savedDates);
                console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allDates.length} ØªØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ`);
            } else {
                const today = new Date();
                const currentMonth = today.getMonth();
                const currentYear = today.getFullYear();
                allDates = [];
                
                for (let i = 1; i <= 5; i++) {
                    const day = Math.floor(Math.random() * 28) + 1;
                    const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    allDates.push(dateStr);
                }
                
                allDates.sort();
            }
            
            renderAdminEmps();
            renderAdminDates();
            updateStats();
            
            console.log('âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ (Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ©)');
        }

        function saveToLocalStorage() {
            try {
                localStorage.setItem('employees', JSON.stringify(allEmployees));
                localStorage.setItem('examDates', JSON.stringify(allDates));
                localStorage.setItem('lastSync', new Date().toISOString());
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹');
            } catch (error) {
                console.warn('âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹:', error);
            }
        }

        async function saveDataToFirebase() {
            if (!firebaseInitialized) {
                console.log('âš ï¸ Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¦ØŒ Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·');
                saveToLocalStorage();
                return false;
            }
            
            try {
                console.log('ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase...');

                saveToLocalStorage();
                
                const batch = db.batch();
                
                allEmployees.forEach(emp => {
                    const empRef = db.collection('employees').doc(emp.nationalId);
                    const empData = {
                        name: emp.name,
                        nationalId: emp.nationalId,
                        schedule: emp.schedule || [],
                        pendingSwaps: emp.pendingSwaps || [],
                        notifications: emp.notifications || [],
                        createdAt: emp.createdAt || new Date().toISOString(),
                        lastUpdated: new Date().toISOString()
                    };
                    batch.set(empRef, empData, { merge: true });
                });
                
                const datesRef = db.collection('settings').doc('examDates');
                batch.set(datesRef, { 
                    dates: allDates,
                    lastUpdated: new Date().toISOString()
                }, { merge: true });
                
                await batch.commit();
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Ø¨Ù†Ø¬Ø§Ø­');
                
                localStorage.setItem('lastFirebaseSync', new Date().toISOString());

                if (typeof renderAdminEmps === 'function') renderAdminEmps();
                if (typeof renderAdminDates === 'function') renderAdminDates();
                if (typeof renderAdminSwaps === 'function') renderAdminSwaps();
                if (typeof updateStats === 'function') updateStats();
                if (typeof renderMasterReport === 'function') renderMasterReport();
                if (typeof currentEmpData !== 'undefined' && currentEmpData) {
                    const currentUpdated = allEmployees.find(e => e.nationalId === currentEmpData.nationalId);
                    if (currentUpdated) {
                        currentEmpData = currentUpdated;
                    }
                    if (typeof renderEmpUI === 'function') renderEmpUI();
                    if (typeof updateNotificationBadge === 'function') updateNotificationBadge();
                }

                return true;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase:', error);
                
                try {
                    for (const emp of allEmployees) {
                        await db.collection('employees').doc(emp.nationalId).set({
                            name: emp.name,
                            nationalId: emp.nationalId,
                            schedule: emp.schedule || [],
                            pendingSwaps: emp.pendingSwaps || [],
                            notifications: emp.notifications || [],
                            createdAt: emp.createdAt || new Date().toISOString(),
                            lastUpdated: new Date().toISOString()
                        }, { merge: true });
                    }
                    
                    await db.collection('settings').doc('examDates').set({ 
                        dates: allDates,
                        lastUpdated: new Date().toISOString()
                    }, { merge: true });
                    
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ÙØ±Ø¯ÙŠ');
                    
                    localStorage.setItem('lastFirebaseSync', new Date().toISOString());

                    if (typeof renderAdminEmps === 'function') renderAdminEmps();
                    if (typeof renderAdminDates === 'function') renderAdminDates();
                    if (typeof renderAdminSwaps === 'function') renderAdminSwaps();
                    if (typeof updateStats === 'function') updateStats();
                    if (typeof currentEmpData !== 'undefined' && currentEmpData) {
                        const currentUpdated = allEmployees.find(e => e.nationalId === currentEmpData.nationalId);
                        if (currentUpdated) {
                            currentEmpData = currentUpdated;
                        }
                        if (typeof renderEmpUI === 'function') renderEmpUI();
                        if (typeof updateNotificationBadge === 'function') updateNotificationBadge();
                    }

                    return true;
                    
                } catch (individualError) {
                    console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„ÙØ±Ø¯ÙŠ:', individualError);
                    
                    saveToLocalStorage();
                    
                    Swal.fire({
                        icon: 'warning',
                        title: 'ØªÙ†Ø¨ÙŠÙ‡',
                        text: 'ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©. ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·.',
                        timer: 3000,
                        showConfirmButton: false
                    });
                    
                    return false;
                }
            }
        }

        function showErrorMessage(message) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            loadingOverlay.innerHTML = `
                <div class="text-center p-4 animate__animated animate__fadeIn">
                    <div class="mb-4">
                        <i class="fas fa-exclamation-triangle fa-4x text-warning mb-3"></i>
                        <h4 class="text-white mb-3">Ø­Ø¯Ø« Ø®Ø·Ø£</h4>
                        <p class="text-white-75 mb-4">${message}</p>
                    </div>
                    
                    <div class="bg-white bg-opacity-10 rounded p-4 mb-4">
                        <h6 class="text-white mb-3"><i class="fas fa-cogs me-2"></i>Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„:</h6>
                        <ol class="text-white-75 text-start" style="max-width: 500px; margin: 0 auto;">
                            <li class="mb-2">ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</li>
                            <li class="mb-2">Ø§ÙØªØ­ <a href="https://console.firebase.google.com/" target="_blank" class="text-warning">Firebase Console</a></li>
                            <li class="mb-2">Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ù‚Ø³Ù… Firestore Database</li>
                            <li class="mb-2">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Rules" ÙˆØ£Ø¹Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø£Ø¯Ù†Ø§Ù‡</li>
                        </ol>
                        
                        <div class="mt-4">
                            <h6 class="text-white mb-2">Ù‚ÙˆØ§Ø¹Ø¯ Firestore Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</h6>
                            <div style="text-align: left; direction: ltr; background: rgba(0,0,0,0.3); color: #fff; padding: 15px; border-radius: 8px; max-width: 600px; margin: 0 auto; overflow: auto; font-family: monospace;">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn btn-light me-2" onclick="location.reload()">
                            <i class="fas fa-redo me-1"></i>Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
                        </button>
                        <button class="btn btn-outline-light" onclick="continueOffline()">
                            <i class="fas fa-wifi-slash me-1"></i>Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„
                        </button>
                    </div>
                </div>
            `;
        }

        function continueOffline() {
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('userInterface').style.display = 'block';
            loadMockData();
        }

        function getDayAr(dateStr) {
            try {
                const date = new Date(dateStr);
                const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
                return days[date.getDay()] || dateStr;
            } catch (e) {
                return dateStr;
            }
        }

        function searchEmployee() {
            const id = document.getElementById('nidInput').value.trim();
            
            if(!id) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ', 'warning');
                return;
            }
            
            const emp = allEmployees.find(e => e.nationalId === id);
            
            if(emp) {
                currentEmpData = emp;
                renderEmpUI();
                
                document.getElementById('searchSection').classList.add('animate__fadeOutUp');
                setTimeout(() => {
                    document.getElementById('searchSection').classList.add('d-none');
                    document.getElementById('searchSection').classList.remove('animate__fadeOutUp');
                    
                    document.getElementById('empDashboard').classList.remove('d-none');
                    document.getElementById('empDashboard').classList.add('animate__fadeInUp');
                }, 300);
                
                updateNotificationBadge();
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø·Ù„Ø¨Ø§Øª ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¹Ù„Ù‚Ø©ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                const incomingSwaps = allEmployees.reduce((count, employee) => {
                    return count + (employee.pendingSwaps || []).filter(sw => sw.targetId === currentEmpData.nationalId && sw.status === 'pending').length;
                }, 0);
                if (incomingSwaps > 0) {
                    setTimeout(() => {
                        try {
                            showNotifications();
                        } catch (err) {
                            console.error('ØªØ¹Ø°Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:', err);
                        }
                    }, 500);
                }
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'ØºÙŠØ± Ù…Ø³Ø¬Ù„',
                    text: 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
                    customClass: {
                        confirmButton: 'btn btn-primary'
                    }
                });
            }
        }

        function renderEmpUI() {
            if(!currentEmpData) return;
            
            document.getElementById('displayName').innerText = currentEmpData.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            document.getElementById('displayId').innerText = `Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ: ${currentEmpData.nationalId}`;
            
            const schedule = currentEmpData.schedule || [];
            const workDays = schedule.filter(s => !s.wasSwappedOut).length;
            const swapDays = schedule.filter(s => s.isSwapped || s.wasSwappedOut).length;
            
            // Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† "ÙŠÙˆÙ… Ø¹Ù…Ù„" Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('workDaysCount').innerText = `${workDays} Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª`;
            document.getElementById('swapDaysCount').innerText = `${swapDays} ØªØ¨Ø¯ÙŠÙ„`;
            
            const progressPercent = allDates.length > 0 ? (workDays / allDates.length * 100) : 0;
            document.getElementById('workProgress').style.width = `${progressPercent}%`;
            
            const tbody = document.getElementById('scheduleTableBody');
            tbody.innerHTML = '';
            
            schedule.forEach(s => {
                const row = document.createElement('tr');
                if (s.isSwapped || s.wasSwappedOut) {
                    row.className = 'swapped-row';
                }
                
                row.innerHTML = `
                    <!-- ØªØ¹Ø¯ÙŠÙ„ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©: Ø§Ù„ÙŠÙˆÙ… Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø«Ù… Ø§Ù„Ø­Ø§Ù„Ø© -->
                    <td>${getDayAr(s.date)}</td>
                    <td>${s.date}</td>
                    <td>
                        ${s.wasSwappedOut ? 
                            '<span class="badge bg-danger">ØªØ¨Ø¯ÙŠÙ„</span>' :
                          s.isSwapped ? 
                            '<span class="badge bg-warning">ØªØ¨Ø¯ÙŠÙ„</span>' : 
                            '<span class="badge bg-success">Ø£Ø³Ø§Ø³ÙŠ</span>'}
                    </td>
                    <td>${s.swappedWith ? s.swappedWith : '-'}</td>
                    <td class="no-print">
                        ${s.isSwapped || s.wasSwappedOut ? 
                            `<button type="button" class="btn btn-sm btn-outline-info" onclick="showSwapDetails('${s.date}')">
                                <i class="fas fa-info-circle"></i>
                            </button>` : 
                            `<button type="button" class="btn btn-sm btn-outline-primary" onclick="requestSwapForDate('${s.date}')">
                                <i class="fas fa-exchange-alt"></i>
                            </button>`}
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            if (schedule.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center py-4 text-muted">
                            <i class="fas fa-calendar-times fa-2x mb-3"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠØ§Ù… Ø¹Ù…Ù„ Ù…Ø®ØµØµØ©</p>
                        </td>
                    </tr>
                `;
            }
            
            updateNotificationBadge();
        }

        function openSwapRequest() {
            if(!currentEmpData) {
                Swal.fire({
                    icon: 'warning',
                    title: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø£ÙˆÙ„Ø§Ù‹',
                    text: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
                return;
            }
            
            const myDates = (currentEmpData.schedule || []).filter(s => !s.wasSwappedOut).map(s => s.date);
            
            if(myDates.length === 0) {
                Swal.fire({
                    icon: 'info',
                    title: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠØ§Ù…',
                    text: 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ÙŠØ§Ù… Ø¹Ù…Ù„ Ù…ØªØ§Ø­Ø© Ù„Ù„ØªØ¨Ø¯ÙŠÙ„',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
                return;
            }
            
            Swal.fire({
                title: 'Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„ Ø°ÙƒÙŠ',
                html: `
                    <div class="text-start">
                        <label class="form-label fw-bold">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø¬Ø¯ÙˆÙ„Ùƒ:</label>
                        <select id="swDate" class="form-select mb-3" onchange="updateAvailableEmps()">
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® --</option>
                            ${myDates.map(d => `<option value="${d}">${d} (${getDayAr(d)})</option>`).join('')}
                        </select>
                        <label class="form-label fw-bold">Ø§Ù„Ø²Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ† (Ù„ÙŠØ³ Ù„Ø¯ÙŠÙ‡Ù… Ø¹Ù…Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…):</label>
                        <select id="swTarget" class="form-select"></select>
                        <div class="mt-3">
                            <label class="form-label fw-bold">Ø±Ø³Ø§Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                            <textarea id="swMessage" class="form-control" rows="2" placeholder="Ø£Ø¶Ù Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©..."></textarea>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                didOpen: () => {
                    window.updateAvailableEmps = () => {
                        const date = document.getElementById('swDate').value;
                        if(!date) return;
                        
                        const available = allEmployees.filter(e => 
                            e.nationalId !== currentEmpData.nationalId && 
                            !(e.schedule || []).some(s => s.date === date && !s.wasSwappedOut)
                        );
                        
                        const select = document.getElementById('swTarget');
                        select.innerHTML = available.length > 0 ? 
                            available.map(e => `<option value="${e.nationalId}">${e.name}</option>`).join('') : 
                            '<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ù…Ù„Ø§Ø¡ Ù…ØªØ§Ø­ÙŠÙ†</option>';
                    };
                    
                    window.updateAvailableEmps();
                },
                preConfirm: async () => {
                    const date = document.getElementById('swDate').value;
                    const targetId = document.getElementById('swTarget').value;
                    
                    if(!date || !targetId) {
                        Swal.showValidationMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø²Ù…ÙŠÙ„');
                        return false;
                    }
                    
                    const target = allEmployees.find(e => e.nationalId === targetId);
                    if (!target) {
                        Swal.showValidationMessage('Ø§Ù„Ø²Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                        return false;
                    }
                    
                    const message = document.getElementById('swMessage').value;
                    
                    const requestId = `swap_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    const request = {
                        requestId: requestId,
                        myDate: date,
                        targetId: targetId,
                        targetName: target.name,
                        requesterId: currentEmpData.nationalId,
                        requesterName: currentEmpData.name,
                        message: message || '',
                        status: 'pending',
                        timestamp: new Date().toISOString()
                    };
                    
                    return await addSwapRequest(request);
                }
            }).then(async result => {
                if(result.isConfirmed) {
                    if (result.value) {
                        Swal.fire({
                            icon: 'success',
                            title: 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„',
                            text: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Ø®Ø·Ø£',
                            text: 'ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    }
                }
            });
        }

        async function addSwapRequest(request) {
            try {
                const empIndex = allEmployees.findIndex(e => e.nationalId === currentEmpData.nationalId);
                if (empIndex !== -1) {
                    if (!allEmployees[empIndex].pendingSwaps) {
                        allEmployees[empIndex].pendingSwaps = [];
                    }
                    allEmployees[empIndex].pendingSwaps.push(request);
                    
                    currentEmpData.pendingSwaps = allEmployees[empIndex].pendingSwaps;
                }
                
                const targetIndex = allEmployees.findIndex(e => e.nationalId === request.targetId);
                if (targetIndex !== -1) {
                    if (!allEmployees[targetIndex].notifications) {
                        allEmployees[targetIndex].notifications = [];
                    }
                    
                    allEmployees[targetIndex].notifications.push({
                        type: 'swap_request',
                        from: currentEmpData.name,
                        message: `Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„ ÙŠÙˆÙ… ${request.myDate}`,
                        requestId: request.requestId,
                        timestamp: new Date().toISOString(),
                        read: false
                    });
                }
                
                const saved = await saveDataToFirebase();
                
                if (saved) {
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ÙÙŠ Firebase');
                } else {
                    console.log('âš ï¸ ØªÙ… Ø­ÙØ¸ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·');
                }
                
                return true;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„:', error);
                
                saveToLocalStorage();
                
                return false;
            }
        }

        function requestSwapForDate(date) {
            if(!currentEmpData) {
                Swal.fire({
                    icon: 'warning',
                    title: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø£ÙˆÙ„Ø§Ù‹',
                    text: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
                return;
            }
            
            const myDates = (currentEmpData.schedule || []).filter(s => !s.wasSwappedOut).map(s => s.date);
            
            if(!myDates.includes(date)) {
                Swal.fire({
                    icon: 'error',
                    title: 'ØºÙŠØ± Ù…ØªØ§Ø­',
                    text: 'Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø¬Ø¯ÙˆÙ„Ùƒ Ø£Ùˆ ØºÙŠØ± Ù…ØªØ§Ø­ Ù„Ù„ØªØ¨Ø¯ÙŠÙ„',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
                return;
            }
            
            const available = allEmployees.filter(e => 
                e.nationalId !== currentEmpData.nationalId && 
                !(e.schedule || []).some(s => s.date === date && !s.wasSwappedOut)
            );
            
            if(available.length === 0) {
                Swal.fire({
                    icon: 'info',
                    title: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ù…Ù„Ø§Ø¡ Ù…ØªØ§Ø­ÙŠÙ†',
                    text: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ù…Ù„Ø§Ø¡ Ù…ØªØ§Ø­ÙŠÙ† Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
                return;
            }
            
            Swal.fire({
                title: 'Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„ Ù„Ù„ØªØ§Ø±ÙŠØ®',
                html: `
                    <div class="text-start">
                        <p>ÙŠÙˆÙ… <b>${date}</b> (${getDayAr(date)})</p>
                        <label class="form-label fw-bold">Ø§Ø®ØªØ± Ø§Ù„Ø²Ù…ÙŠÙ„ Ù„Ù„ØªØ¨Ø¯ÙŠÙ„:</label>
                        <select id="swTargetDirect" class="form-select mb-3">
                            ${available.map(e => `<option value="${e.nationalId}">${e.name}</option>`).join('')}
                        </select>
                        <div class="mt-3">
                            <label class="form-label fw-bold">Ø±Ø³Ø§Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                            <textarea id="swMessageDirect" class="form-control" rows="2" placeholder="Ø£Ø¶Ù Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©..."></textarea>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                icon: 'question',
                preConfirm: async () => {
                    const targetId = document.getElementById('swTargetDirect').value;
                    const message = document.getElementById('swMessageDirect').value;
                    
                    const target = allEmployees.find(e => e.nationalId === targetId);
                    if (!target) {
                        Swal.showValidationMessage('Ø§Ù„Ø²Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                        return false;
                    }
                    
                    const requestId = `swap_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    const request = {
                        requestId: requestId,
                        myDate: date,
                        targetId: targetId,
                        targetName: target.name,
                        requesterId: currentEmpData.nationalId,
                        requesterName: currentEmpData.name,
                        message: message || '',
                        status: 'pending',
                        timestamp: new Date().toISOString()
                    };
                    
                    return await addSwapRequest(request);
                }
            }).then(async result => {
                if(result.isConfirmed) {
                    if (result.value) {
                        Swal.fire({
                            icon: 'success',
                            title: 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„',
                            text: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Ø®Ø·Ø£',
                            text: 'ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    }
                }
            });
        }

        function downloadSchedule() {
            if(!currentEmpData) {
                Swal.fire({
                    icon: 'warning',
                    title: 'ÙŠØ¬Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø£ÙˆÙ„Ø§Ù‹',
                    text: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
                return;
            }
            
            const schedule = currentEmpData.schedule || [];
            
            if(schedule.length === 0) {
                Swal.fire({
                    icon: 'info',
                    title: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ø¯ÙˆÙ„',
                    text: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¹Ù…Ù„ Ù„Ø­ÙØ¸Ù‡',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
                return;
            }
            
            const scheduleHtml = `
                <div class="schedule-for-capture">
                    <h3 style="text-align: center; color: #000; margin-bottom: 20px;">Ø¬Ø¯ÙˆÙ„ ${currentEmpData.name}</h3>
                    <p style="text-align: center; color: #000; margin-bottom: 20px;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ: ${currentEmpData.nationalId}</p>
                    <table border="1" cellspacing="0" cellpadding="8" style="width: 100%; border-collapse: collapse; color: #000;">
                        <thead>
                            <tr style="background: #005f73; color: white;">
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„ÙŠÙˆÙ…</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${schedule.map(s => `
                                <tr ${s.isSwapped || s.wasSwappedOut ? 'style="background-color: #fff3cd;"' : ''}>
                                    <td style="text-align: center;">${s.date}</td>
                                    <td style="text-align: center;">${getDayAr(s.date)}</td>
                                    <td style="text-align: center;">
                                        ${s.wasSwappedOut ? 
                                            '<span style="background: #dc3545; color: white; padding: 3px 8px; border-radius: 4px;">ØªØ¨Ø¯ÙŠÙ„</span>' :
                                          s.isSwapped ? 
                                            '<span style="background: #ffc107; color: black; padding: 3px 8px; border-radius: 4px;">ØªØ¨Ø¯ÙŠÙ„</span>' : 
                                            '<span style="background: #198754; color: white; padding: 3px 8px; border-radius: 4px;">Ø£Ø³Ø§Ø³ÙŠ</span>'}
                                    </td>
                                    <td style="text-align: center;">${s.swappedWith ? s.swappedWith : '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <p style="text-align: center; color: #000; margin-top: 20px; font-size: 12px;">
                        ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠ ${new Date().toLocaleDateString('ar-EG')}
                    </p>
                </div>
            `;
            
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = scheduleHtml;
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.style.top = '0';
            tempDiv.style.width = '800px';
            tempDiv.style.backgroundColor = 'white';
            tempDiv.style.padding = '20px';
            document.body.appendChild(tempDiv);
            
            Swal.fire({
                title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„',
                text: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            html2canvas(tempDiv, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                Swal.close();
                const link = document.createElement('a');
                link.download = `Ø¬Ø¯ÙˆÙ„_${currentEmpData.name}_${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                document.body.removeChild(tempDiv);
                
                Swal.fire({
                    icon: 'success',
                    title: 'ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„',
                    text: 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­',
                    timer: 1500,
                    showConfirmButton: false
                });
            }).catch(error => {
                Swal.close();
                document.body.removeChild(tempDiv);
                Swal.fire({
                    icon: 'error',
                    title: 'Ø®Ø·Ø£',
                    text: 'ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
                console.error('Ø®Ø·Ø£ ÙÙŠ html2canvas:', error);
            });
        }

        function showAdminLogin() {
            document.getElementById('loginModal').classList.remove('d-none');
            document.getElementById('adminPass').focus();
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('d-none');
            document.getElementById('adminPass').value = '';
        }

        function checkAdmin() {
            const password = document.getElementById('adminPass').value;
            
            if(password === '85208520') {
                hideLoginModal();
                document.getElementById('userInterface').style.display = 'none';
                document.getElementById('adminDashboardView').style.display = 'block';
                
                const hour = new Date().getHours();
                let greeting = 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±';
                if(hour < 12) greeting = 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±';
                else if(hour < 18) greeting = 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±';
                
                document.getElementById('adminWelcome').innerText = `${greeting}ØŒ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…`;
                
                switchAdminTab('adm1', document.querySelector('.admin-nav-link.active'));
                
                document.getElementById('adminDashboardView').classList.add('animate__fadeIn');
            } else {
                Swal.fire('Ø®Ø·Ø£', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                document.getElementById('adminPass').value = '';
                document.getElementById('adminPass').focus();
            }
        }

        function logoutAdmin() {
            Swal.fire({
                title: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®Ø±ÙˆØ¬',
                text: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…ØŸ',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø®Ø±ÙˆØ¬',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
            }).then(result => {
                if(result.isConfirmed) {
                    document.getElementById('adminDashboardView').style.display = 'none';
                    document.getElementById('userInterface').style.display = 'block';
                    
                    document.getElementById('searchSection').classList.remove('d-none');
                    document.getElementById('empDashboard').classList.add('d-none');
                    
                    document.getElementById('userInterface').classList.add('animate__fadeIn');
                }
            });
        }

        async function addManualEmployee() {
            const name = document.getElementById('aName').value.trim();
            const id = document.getElementById('aId').value.trim();
            
            if(!name || !id) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'warning');
                return;
            }
            
            if(id.length !== 14) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 14 Ø±Ù‚Ù…Ù‹Ø§', 'warning');
                return;
            }
            
            const existing = allEmployees.find(e => e.nationalId === id);
            if(existing) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'warning');
                return;
            }
            
            try {
                const employeeData = {
                    name: name,
                    nationalId: id,
                    schedule: [],
                    pendingSwaps: [],
                    notifications: [],
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                allEmployees.push(employeeData);
                
                const saved = await saveDataToFirebase();
                
                if (saved) {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©',
                        text: 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©',
                        text: 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }
                
                document.getElementById('aName').value = '';
                document.getElementById('aId').value = '';
                document.getElementById('aName').focus();
                
                renderAdminEmps();
                updateStats();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù:', error);
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
            }
        }

        async function importFromExcel() {
            const fileInput = document.getElementById('excelFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel', 'warning');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    console.log('ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù:', jsonData);
                    
                    if (jsonData.length === 0) {
                        Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
                        return;
                    }
                    
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    for (const row of jsonData) {
                        const name = row['Ø§Ù„Ø§Ø³Ù…'] || row['Ø§Ø³Ù…'] || row['Name'] || row['name'] || row['Ø§Ù„Ù…ÙˆØ¸Ù'] || row['EMPLOYEE_NAME'];
                        const nationalId = row['Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ'] || row['Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ'] || row['National ID'] || row['nationalId'] || row['id'] || row['Ø§Ù„Ø±Ù‚Ù…'] || row['NATIONAL_ID'];
                        
                        if (!name || !nationalId) {
                            console.warn('âŒ ØµÙ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„:', row);
                            skippedCount++;
                            continue;
                        }
                        
                        const existing = allEmployees.find(e => e.nationalId === nationalId.toString());
                        if (existing) {
                            console.log('âš ï¸ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹:', name);
                            skippedCount++;
                            continue;
                        }
                        
                        const employeeData = {
                            name: name.toString(),
                            nationalId: nationalId.toString(),
                            schedule: [],
                            pendingSwaps: [],
                            notifications: [],
                            createdAt: new Date().toISOString(),
                            lastUpdated: new Date().toISOString()
                        };
                        
                        try {
                            allEmployees.push(employeeData);
                            importedCount++;
                            console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ©:', name);
                        } catch (error) {
                            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ©:', name, error);
                            skippedCount++;
                        }
                    }
                    
                    const saved = await saveDataToFirebase();
                    
                    if (saved) {
                        Swal.fire({
                            icon: 'success',
                            title: 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯',
                            html: `ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ <b>${importedCount}</b> Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡Ù… ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©<br>
                                   ØªÙ… ØªØ®Ø·ÙŠ <b>${skippedCount}</b> Ù…ÙˆØ¸Ù (Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©)`,
                            timer: 3000,
                            showConfirmButton: false
                        });
                    } else {
                        Swal.fire({
                            icon: 'success',
                            title: 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯',
                            html: `ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ <b>${importedCount}</b> Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)<br>
                                   ØªÙ… ØªØ®Ø·ÙŠ <b>${skippedCount}</b> Ù…ÙˆØ¸Ù (Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©)`,
                            timer: 3000,
                            showConfirmButton: false
                        });
                    }
                    
                    fileInput.value = '';
                    
                    renderAdminEmps();
                    updateStats();
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù:', error);
                    Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel', 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function renderAdminEmps() {
            const container = document.getElementById('adminEmpsList');
            
            if(!allEmployees || allEmployees.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-users fa-2x mb-3"></i>
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</p>
                        <button class="btn btn-sm btn-primary mt-2" onclick="importFromExcel()">
                            <i class="fas fa-file-excel me-1"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel
                        </button>
                    </div>`;
                document.getElementById('empCount').innerText = '0 Ù…ÙˆØ¸Ù';
                return;
            }
            
            let html = '';
            allEmployees.forEach((emp, index) => {
                const scheduleCount = emp.schedule ? emp.schedule.length : 0;
                const pendingSwapsCount = emp.pendingSwaps ? emp.pendingSwaps.filter(s => s.status === 'pending').length : 0;
                
                html += `
                    <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center animate__animated animate__fadeInUp" 
                         style="animation-delay: ${index * 0.05}s">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                                     style="width: 40px; height: 40px;">
                                    ${emp.name.split(' ').map(n => n[0]).join('').toUpperCase() || '??'}
                                </div>
                            </div>
                            <div>
                                <h6 class="mb-1 fw-bold">${emp.name}</h6>
                                <small class="text-muted">${emp.nationalId}</small>
                                <div class="mt-1">
                                    <span class="badge bg-success me-1">${scheduleCount} ÙŠÙˆÙ…</span>
                                    ${pendingSwapsCount > 0 ? 
                                        `<span class="badge bg-warning">${pendingSwapsCount} Ø·Ù„Ø¨</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="openAssignModal('${emp.nationalId}')">
                                <i class="fas fa-calendar-plus"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-info" onclick="showEmpDetailsAdmin('${emp.nationalId}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteEmp('${emp.nationalId}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>`;
            });
            
            container.innerHTML = html;
            document.getElementById('empCount').innerText = `${allEmployees.length} Ù…ÙˆØ¸Ù`;
        }

        function showEmpDetailsAdmin(empId) {
            const emp = allEmployees.find(e => e.nationalId === empId);
            if(!emp) return;
            
            const scheduleCount = emp.schedule ? emp.schedule.length : 0;
            const pendingSwapsCount = emp.pendingSwaps ? emp.pendingSwaps.filter(s => s.status === 'pending').length : 0;
            const completedSwapsCount = emp.pendingSwaps ? emp.pendingSwaps.filter(s => s.status === 'completed').length : 0;
            
            let scheduleHtml = '';
            if(scheduleCount > 0) {
                scheduleHtml = '<ul class="list-group list-group-flush">';
                emp.schedule.forEach(s => {
                    scheduleHtml += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                ${s.date} (${getDayAr(s.date)})
                                ${s.isSwapped ? `<span class="badge bg-warning ms-2">ØªØ¨Ø¯ÙŠÙ„</span>` : ''}
                                ${s.wasSwappedOut ? `<span class="badge bg-danger ms-2">ØªØ¨Ø¯ÙŠÙ„</span>` : ''}
                            </div>
                            ${s.swappedWith ? `<small class="text-muted">Ù…Ø¹ ${s.swappedWith}</small>` : ''}
                        </li>`;
                });
                scheduleHtml += '</ul>';
            }
            
            Swal.fire({
                title: emp.name,
                html: `
                    <div class="text-start">
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <h6 class="fw-bold">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</h6>
                                    <p class="mb-0">${emp.nationalId}</p>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <h6 class="fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h6>
                                    <p class="mb-0">${emp.createdAt ? new Date(emp.createdAt).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-4 text-center">
                                <div class="p-2 bg-primary bg-opacity-10 rounded">
                                    <h3 class="text-primary">${scheduleCount}</h3>
                                    <!-- Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
                                    <small>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</small>
                                </div>
                            </div>
                            <div class="col-4 text-center">
                                <div class="p-2 bg-warning bg-opacity-10 rounded">
                                    <h3 class="text-warning">${pendingSwapsCount}</h3>
                                    <small>Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</small>
                                </div>
                            </div>
                            <div class="col-4 text-center">
                                <div class="p-2 bg-success bg-opacity-10 rounded">
                                    <h3 class="text-success">${completedSwapsCount}</h3>
                                    <small>ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</small>
                                </div>
                            </div>
                        </div>
                        
                        ${scheduleCount > 0 ? `
                        <div class="mb-3">
                            <h6 class="fw-bold">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„</h6>
                            ${scheduleHtml}
                        </div>` : ''}
                    </div>
                `,
                width: 600,
                showConfirmButton: false,
                showCloseButton: true
            });
        }

        async function deleteEmp(empId) {
            Swal.fire({
                title: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù',
                text: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                confirmButtonColor: '#dc3545'
            }).then(async result => {
                if(result.isConfirmed) {
                    try {
                        allEmployees = allEmployees.filter(e => e.nationalId !== empId);

                        saveToLocalStorage();

                        renderAdminEmps();
                        updateStats();

                        const saved = await saveDataToFirebase();

                        if (saved) {
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù',
                                text: 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ÙˆØ§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©',
                                timer: 1500,
                                showConfirmButton: false
                            });
                        } else {
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù',
                                text: 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·',
                                timer: 1500,
                                showConfirmButton: false
                            });
                        }

                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:', error);
                        Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
                    }
                }
            });
        }

        async function addDate() {
            const dateInput = document.getElementById('newDate');
            const date = dateInput.value;
            
            if(!date) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®', 'warning');
                return;
            }
            
            if(allDates.includes(date)) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø¶Ø§Ù Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'warning');
                return;
            }
            
            try {
                allDates.push(date);
                allDates.sort();
                
                const saved = await saveDataToFirebase();
                
                if (saved) {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©',
                        text: 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
                        timer: 1500,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©',
                        text: 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ù†Ø¬Ø§Ø­ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }
                
                dateInput.value = '';
                renderAdminDates();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®:', error);
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®', 'error');
            }
        }

        async function addMultipleDates() {
            Swal.fire({
                title: 'Ø¥Ø¶Ø§ÙØ© Ù†Ø·Ø§Ù‚ ØªÙˆØ§Ø±ÙŠØ®',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="dateFrom" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="dateTo" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø£ÙŠØ§Ù…</label>
                            <select id="excludeDays" class="form-select" multiple>
                                <option value="0">Ø§Ù„Ø£Ø­Ø¯</option>
                                <option value="1">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option>
                                <option value="2">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                                <option value="3">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                                <option value="4">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                                <option value="5">Ø§Ù„Ø¬Ù…Ø¹Ø©</option>
                                <option value="6">Ø§Ù„Ø³Ø¨Øª</option>
                            </select>
                            <small class="text-muted">Ø§Ø¶ØºØ· Ctrl Ù„Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† ÙŠÙˆÙ…</small>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Ø¥Ø¶Ø§ÙØ©',
                preConfirm: () => {
                    const from = document.getElementById('dateFrom').value;
                    const to = document.getElementById('dateTo').value;
                    const excludeDays = Array.from(document.getElementById('excludeDays').selectedOptions)
                        .map(opt => parseInt(opt.value));
                    
                    if(!from || !to) {
                        Swal.showValidationMessage('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                        return false;
                    }
                    
                    const fromDate = new Date(from);
                    const toDate = new Date(to);
                    
                    if(fromDate > toDate) {
                        Swal.showValidationMessage('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©');
                        return false;
                    }
                    
                    const datesToAdd = [];
                    const currentDate = new Date(fromDate);
                    
                    while(currentDate <= toDate) {
                        const dateStr = currentDate.toISOString().split('T')[0];
                        const dayOfWeek = currentDate.getDay();
                        
                        if(!excludeDays.includes(dayOfWeek) && !allDates.includes(dateStr)) {
                            datesToAdd.push(dateStr);
                        }
                        
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    if(datesToAdd.length === 0) {
                        Swal.showValidationMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØ§Ø±ÙŠØ® Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§');
                        return false;
                    }
                    
                    return datesToAdd;
                }
            }).then(async result => {
                if(result.isConfirmed && result.value) {
                    try {
                        const newDates = [...allDates, ...result.value];
                        newDates.sort();
                        
                        allDates = newDates;
                        
                        const saved = await saveDataToFirebase();
                        
                        if (saved) {
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©',
                                text: `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${result.value.length} ØªØ§Ø±ÙŠØ® Ø¬Ø¯ÙŠØ¯ ÙˆØ­ÙØ¸Ù‡Ù… ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©`,
                                timer: 2000,
                                showConfirmButton: false
                            });
                        } else {
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©',
                                text: `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${result.value.length} ØªØ§Ø±ÙŠØ® Ø¬Ø¯ÙŠØ¯ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)`,
                                timer: 2000,
                                showConfirmButton: false
                            });
                        }
                        
                        renderAdminDates();
                        
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®:', error);
                        Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®', 'error');
                    }
                }
            });
        }

        function renderAdminDates() {
            const container = document.getElementById('adminDatesList');
            
            if(!allDates || allDates.length === 0) {
                container.innerHTML = `
                    <div class="text-center w-100 py-3 text-muted">
                        <i class="fas fa-calendar-times fa-2x mb-2"></i>
                        <p class="mb-0">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ ØªÙˆØ§Ø±ÙŠØ®</p>
                    </div>`;
                return;
            }
            
            let html = '';
            allDates.forEach(date => {
                html += `
                    <div class="badge bg-secondary p-2 d-flex align-items-center animate__animated animate__fadeIn">
                        <span>${date} (${getDayAr(date).substr(0, 3)})</span>
                        <button type="button" class="btn btn-sm btn-outline-light ms-2" onclick="deleteDate('${date}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`;
            });
            
            container.innerHTML = html;
        }

        async function deleteDate(date) {
            Swal.fire({
                title: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù',
                text: `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØªØ§Ø±ÙŠØ® ${date}ØŸ`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
            }).then(async result => {
                if(result.isConfirmed) {
                    try {
                        const newDates = allDates.filter(d => d !== date);
                        allDates = newDates;
                        
                        const saved = await saveDataToFirebase();
                        
                        if (saved) {
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù',
                                text: 'ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ÙˆØ§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©',
                                timer: 1500,
                                showConfirmButton: false
                            });
                        } else {
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù',
                                text: 'ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·',
                                timer: 1500,
                                showConfirmButton: false
                            });
                        }
                        
                        renderAdminDates();
                        
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ§Ø±ÙŠØ®:', error);
                        Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„ØªØ§Ø±ÙŠØ®', 'error');
                    }
                }
            });
        }

        function filterAssignSearch() {
            const query = document.getElementById('assignSearch').value.toLowerCase().trim();
            const container = document.getElementById('assignSearchResults');
            
            if(!query) {
                container.innerHTML = `
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-search fa-2x mb-3"></i>
                        <p>Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸Ù</p>
                    </div>`;
                return;
            }
            
            const results = allEmployees.filter(emp => 
                (emp.name && emp.name.toLowerCase().includes(query)) || 
                (emp.nationalId && emp.nationalId.includes(query))
            );
            
            if(results.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-user-slash fa-2x mb-3"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«</p>
                    </div>`;
                return;
            }
            
            let html = '';
            results.forEach(emp => {
                const scheduleCount = emp.schedule ? emp.schedule.length : 0;
                
                html += `
                    <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" 
                            onclick="openAssignModal('${emp.nationalId}')">
                        <div>
                            <h6 class="mb-1 fw-bold">${emp.name}</h6>
                            <small class="text-muted">${emp.nationalId}</small>
                        </div>
                        <div>
                            <span class="badge ${scheduleCount > 0 ? 'bg-success' : 'bg-secondary'}">
                                ${scheduleCount} ÙŠÙˆÙ…
                            </span>
                        </div>
                    </button>`;
            });
            
            container.innerHTML = html;
        }

        function openAssignModal(empId) {
            const emp = allEmployees.find(e => e.nationalId === empId);
            if(!emp) return;
            
            const currentDates = (emp.schedule || []).map(s => s.date);
            
            let datesHtml = '';
            if(allDates.length > 0) {
                allDates.forEach(date => {
                    const isChecked = currentDates.includes(date);
                    datesHtml += `
                        <div class="col-md-4 col-sm-6 mb-2">
                            <div class="form-check">
                                <input class="form-check-input assign-date-cb" type="checkbox" 
                                       value="${date}" id="assign_${date}" ${isChecked ? 'checked' : ''}>
                                <label class="form-check-label" for="assign_${date}">
                                    ${date} (${getDayAr(date)})
                                </label>
                            </div>
                        </div>`;
                });
            } else {
                datesHtml = `
                    <div class="col-12 text-center py-4 text-muted">
                        <i class="fas fa-calendar-times fa-2x mb-3"></i>
                        <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
                        <p class="small">ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© ØªÙˆØ§Ø±ÙŠØ® Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ù‚Ø³Ù… "Ø§Ù„ØªÙˆØ²ÙŠØ¹"</p>
                    </div>`;
            }
            
            Swal.fire({
                title: `ØªÙˆØ²ÙŠØ¹ Ø¬Ø¯ÙˆÙ„ ${emp.name}`,
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <p class="mb-1"><b>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</b> ${emp.nationalId}</p>
                            <p class="mb-3"><b>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</b> ${currentDates.length} ÙŠÙˆÙ…</p>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="fw-bold m-0">ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h6>
                                <div>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="selectAllDates()">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                                    <button class="btn btn-sm btn-outline-secondary ms-1" onclick="deselectAllDates()">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„</button>
                                </div>
                            </div>
                            <div class="row mt-2" style="max-height: 300px; overflow-y: auto;">
                                ${datesHtml}
                            </div>
                        </div>
                    </div>
                `,
                width: 700,
                showCancelButton: true,
                confirmButtonText: 'Ø­ÙØ¸ Ø§Ù„ØªÙˆØ²ÙŠØ¹',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                didOpen: () => {
                    window.selectAllDates = () => {
                        document.querySelectorAll('.assign-date-cb').forEach(cb => {
                            cb.checked = true;
                        });
                    };

                    window.deselectAllDates = () => {
                        document.querySelectorAll('.assign-date-cb').forEach(cb => {
                            cb.checked = false;
                        });
                    };

                    const confirmBtn = Swal.getConfirmButton();
                    if (confirmBtn) {
                        confirmBtn.addEventListener('click', async (e) => {
                            e.preventDefault();
                            confirmBtn.disabled = true;

                            const selectedDates = Array.from(document.querySelectorAll('.assign-date-cb:checked'))
                                .map(cb => ({
                                    date: cb.value,
                                    isSwapped: false,
                                    wasSwappedOut: false,
                                    swappedWith: null
                                }));

                            const empIndex = allEmployees.findIndex(e => e.nationalId === empId);
                            if (empIndex !== -1) {
                                allEmployees[empIndex].schedule = selectedDates;
                                allEmployees[empIndex].lastUpdated = new Date().toISOString();

                                if (currentEmpData && currentEmpData.nationalId === empId) {
                                    currentEmpData.schedule = selectedDates;
                                }
                            }

                            let savedToCloud = false;
                            try {
                                savedToCloud = await saveDataToFirebase();
                            } catch (err) {
                                console.error('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªÙˆØ²ÙŠØ¹:', err);
                            }

                            Swal.close();

                            const successText = savedToCloud ?
                                'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©' :
                                'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)';
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„ØªÙˆØ²ÙŠØ¹',
                                text: successText,
                                timer: 1500,
                                showConfirmButton: false
                            });

                            if (typeof renderAdminEmps === 'function') {
                                renderAdminEmps();
                            }
                            if (currentEmpData && currentEmpData.nationalId === empId && typeof renderEmpUI === 'function') {
                                renderEmpUI();
                            }
                            if (typeof filterAssignSearch === 'function') {
                                setTimeout(() => {
                                    try {
                                        filterAssignSearch();
                                    } catch (_) {}
                                    const assignInput = document.getElementById('assignSearch');
                                    if (assignInput) {
                                        assignInput.dispatchEvent(new KeyboardEvent('keyup'));
                                    }
                                }, 50);
                            }
                        }, { once: true });
                    }
                }
            });
        }

        function renderMasterReport() {
            const container = document.getElementById('masterReportArea');
            
            if(allEmployees.length === 0 || allDates.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-file-alt fa-3x mb-3"></i>
                        <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</h5>
                        <p>ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØªÙˆØ§Ø±ÙŠØ® Ø£ÙˆÙ„Ø§Ù‹</p>
                    </div>`;
                return;
            }
            
            let html = `
                <div style="overflow-x: auto;">
                    <table class="table table-bordered table-sm text-center align-middle" style="min-width: 800px; font-size: 12px;">
                        <thead class="table-dark">
                            <tr>
                                <th style="width: 200px; font-size: 11px;" class="text-start">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                ${allDates.map(date => `
                                    <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø£ÙˆÙ„ Ø«Ù„Ø§Ø«Ø© Ø£Ø­Ø±Ù Ù„Ù„ØªÙˆØ¶ÙŠØ­ -->
                                    <th style="font-size: 11px; min-width: 70px;">${date}<br><small>${getDayAr(date)}</small></th>
                                `).join('')}
                                <th style="font-size: 11px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            </tr>
                        </thead>
                        <tbody>`;
            
            allEmployees.forEach(emp => {
                const schedule = emp.schedule || [];
                let totalDays = 0;
                
                html += `<tr>
                    <td class="text-start fw-bold" style="font-size: 11px;">${emp.name}</td>`;
                
                allDates.forEach(date => {
                    const assignment = schedule.find(s => s.date === date);
                    
                    if(!assignment) {
                        html += `<td class="bg-light"></td>`;
                    } else if(assignment.wasSwappedOut) {
                        html += `<td class="bg-danger bg-opacity-25" style="font-size: 10px;" title="ØªØ¨Ø¯ÙŠÙ„ ${assignment.swappedWith || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}">
                            <i class="fas fa-arrow-right text-danger"></i>
                        </td>`;
                    } else if(assignment.isSwapped) {
                        html += `<td class="bg-warning bg-opacity-25" style="font-size: 10px;" title="Ø¨Ø¯Ù„ Ù…Ù† ${assignment.swappedWith || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}">
                            <i class="fas fa-exchange-alt text-warning"></i>
                        </td>`;
                        totalDays++;
                    } else {
                        html += `<td class="bg-success bg-opacity-50">
                            <i class="fas fa-check text-success"></i>
                        </td>`;
                        totalDays++;
                    }
                });
                
                html += `<td class="fw-bold" style="font-size: 11px;">${totalDays}</td></tr>`;
            });
            
            html += `<tr class="table-info">
                <td class="text-start fw-bold" style="font-size: 11px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>`;
            
            allDates.forEach(date => {
                const count = allEmployees.filter(emp => 
                    (emp.schedule || []).some(s => s.date === date && !s.wasSwappedOut)
                ).length;
                html += `<td class="fw-bold" style="font-size: 11px;">${count}</td>`;
            });
            
            html += `<td class="fw-bold" style="font-size: 11px;">${allEmployees.reduce((sum, emp) => 
                sum + (emp.schedule || []).filter(s => !s.wasSwappedOut).length, 0)}</td>
            </tr>`;
            
            html += `</tbody></table></div>`;
            
            container.innerHTML = html;
        }

        function exportMasterReport() {
            if(allEmployees.length === 0 || allDates.length === 0) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'info');
                return;
            }
            
            const data = [];
            
            data.push(['Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© - ' + new Date().toLocaleDateString('ar-EG')]);
            data.push([]);
            
            const headers = ['Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù', ...allDates, 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'];
            data.push(headers);
            
            allEmployees.forEach(emp => {
                const schedule = emp.schedule || [];
                let totalDays = 0;
                
                const row = [emp.name];
                
                allDates.forEach(date => {
                    const assignment = schedule.find(s => s.date === date);
                    
                    if(!assignment) {
                        row.push('');
                    } else if(assignment.wasSwappedOut) {
                        row.push(`ØªØ¨Ø¯ÙŠÙ„ ${assignment.swappedWith || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`);
                    } else if(assignment.isSwapped) {
                        row.push(`Ø¨Ø¯Ù„ Ù…Ù† ${assignment.swappedWith || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`);
                        totalDays++;
                    } else {
                        row.push('Ù…ÙƒÙ„Ù');
                        totalDays++;
                    }
                });
                
                row.push(totalDays);
                data.push(row);
            });
            
            const totalRow = ['Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'];
            allDates.forEach(date => {
                const count = allEmployees.filter(emp => 
                    (emp.schedule || []).some(s => s.date === date && !s.wasSwappedOut)
                ).length;
                totalRow.push(count);
            });
            totalRow.push(allEmployees.reduce((sum, emp) => 
                sum + (emp.schedule || []).filter(s => !s.wasSwappedOut).length, 0));
            data.push(totalRow);
            
            try {
                const ws = XLSX.utils.aoa_to_sheet(data);
                
                const wscols = [
                    { wch: 25 },
                    ...allDates.map(() => ({ wch: 12 })),
                    { wch: 8 }
                ];
                ws['!cols'] = wscols;
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù…');
                
                const fileName = `Ø§Ù„Ø¬Ø¯ÙˆÙ„_Ø§Ù„Ø¹Ø§Ù…_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                Swal.fire({
                    icon: 'success',
                    title: 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±',
                    text: 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­',
                    timer: 1500,
                    showConfirmButton: false
                });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:', error);
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù', 'error');
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙˆØ²ÙŠØ¹
        function renderAssignmentOverview() {
            const container = document.getElementById('assignmentOverview');
            if (!container) return;

            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙˆÙ† Ø£Ùˆ ØªÙˆØ§Ø±ÙŠØ®ØŒ Ø§Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ©
            if (!allEmployees || allEmployees.length === 0 || !allDates || allDates.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-3 text-muted">
                        <i class="fas fa-table fa-2x mb-2"></i>
                        <p class="mb-0">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>
                    </div>`;
                return;
            }

            // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            let html = `
                <div style="overflow-x:auto;">
                    <table class="table table-bordered table-sm text-center align-middle">
                        <thead class="table-secondary">
                            <tr>
                                <th class="text-start">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>`;
            allDates.forEach(date => {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø£ÙˆÙ„ Ø«Ù„Ø§Ø«Ø© Ø£Ø­Ø±Ù
                html += `<th>${date}<br><small>${getDayAr(date)}</small></th>`;
            });
            html += `<th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead><tbody>`;

            allEmployees.forEach(emp => {
                const schedule = emp.schedule || [];
                let total = 0;
                html += `<tr><td class="text-start">${emp.name}</td>`;
                allDates.forEach(date => {
                    const assignment = schedule.find(s => s.date === date);
                    if (!assignment) {
                        html += `<td></td>`;
                    } else if (assignment.wasSwappedOut) {
                        html += `<td><i class="fas fa-arrow-right text-danger"></i></td>`;
                    } else if (assignment.isSwapped) {
                        html += `<td><i class="fas fa-exchange-alt text-warning"></i></td>`;
                        total++;
                    } else {
                        html += `<td><i class="fas fa-check text-success"></i></td>`;
                        total++;
                    }
                });
                html += `<td>${total}</td></tr>`;
            });
            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }

        function updateStats() {
            let pendingSwaps = 0;
            let completedSwaps = 0;
            
            allEmployees.forEach(emp => {
                (emp.pendingSwaps || []).forEach(swap => {
                    if(swap.status === 'pending') pendingSwaps++;
                    else if(swap.status === 'completed') completedSwaps++;
                });
            });
            
            if(document.getElementById('statsSummary')) {
                let summaryHtml = `
                    <div class="mb-3">
                        <h6 class="fw-bold">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h6>
                        <div class="row mt-3">
                            <div class="col-6 mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:</span>
                                    <span class="fw-bold">${allEmployees.length}</span>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Ø£ÙŠØ§Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª:</span>
                                    <span class="fw-bold">${allDates.length}</span>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¨Ø¯ÙŠÙ„:</span>
                                    <span class="fw-bold">${pendingSwaps}</span>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©:</span>
                                    <span class="fw-bold">${completedSwaps}</span>
                                </div>
                            </div>
                        </div>
                    </div>`;
                
                document.getElementById('statsSummary').innerHTML = summaryHtml;
            }
            
            updateStatsChart();

            // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            if (typeof renderAssignmentOverview === 'function') {
                try {
                    renderAssignmentOverview();
                } catch (err) {
                    console.error('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹:', err);
                }
            }
        }

        function updateStatsChart() {
            const ctx = document.getElementById('statsChart');
            if(!ctx) return;
            
            let pendingByDate = {};
            let completedByDate = {};
            
            allEmployees.forEach(emp => {
                (emp.pendingSwaps || []).forEach(swap => {
                    if(swap.status === 'pending') {
                        pendingByDate[swap.myDate] = (pendingByDate[swap.myDate] || 0) + 1;
                    } else if(swap.status === 'completed') {
                        completedByDate[swap.myDate] = (completedByDate[swap.myDate] || 0) + 1;
                    }
                });
            });
            
            const labels = allDates.slice(-7);
            const pendingData = labels.map(date => pendingByDate[date] || 0);
            const completedData = labels.map(date => completedByDate[date] || 0);
            
            if(statsChart) {
                statsChart.data.labels = labels;
                statsChart.data.datasets[0].data = pendingData;
                statsChart.data.datasets[1].data = completedData;
                statsChart.update();
            } else {
                statsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©',
                                data: pendingData,
                                backgroundColor: 'rgba(255, 193, 7, 0.7)',
                                borderColor: 'rgb(255, 193, 7)',
                                borderWidth: 1
                            },
                            {
                                label: 'Ù…ÙƒØªÙ…Ù„Ø©',
                                data: completedData,
                                backgroundColor: 'rgba(25, 135, 84, 0.7)',
                                borderColor: 'rgb(25, 135, 84)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                                rtl: true
                            },
                            title: {
                                display: true,
                                text: 'Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ÙÙŠ Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
        }

        function switchAdminTab(tabId, element) {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.add('d-none');
            });
            
            document.getElementById(tabId).classList.remove('d-none');
            
            document.querySelectorAll('.admin-nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            element.classList.add('active');
            
            if(tabId === 'adm4') {
                renderMasterReport();
            } else if(tabId === 'adm5') {
                setTimeout(() => {
                    updateStatsChart();
                }, 100);
            } else if(tabId === 'adm3') {
                renderAdminSwaps();
            }
        }

        function showEmpDetails() {
            if(!currentEmpData) return;
            
            const schedule = currentEmpData.schedule || [];
            const workDays = schedule.filter(s => !s.wasSwappedOut).length;
            const swapDays = schedule.filter(s => s.isSwapped || s.wasSwappedOut).length;
            
            let scheduleHtml = '';
            if(schedule.length > 0) {
                schedule.forEach(s => {
                    scheduleHtml += `
                        <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-2">
                            <div>
                                <span class="fw-bold">${s.date}</span>
                                <small class="text-muted ms-2">(${getDayAr(s.date)})</small>
                            </div>
                            <div>
                                ${s.isSwapped ? 
                                    `<span class="badge bg-warning">ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¹ ${s.swappedWith || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>` : 
                                  s.wasSwappedOut ? 
                                    `<span class="badge bg-danger">ØªØ¨Ø¯ÙŠÙ„ ${s.swappedWith || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>` :
                                    `<span class="badge bg-success">Ù…ÙƒÙ„Ù</span>`}
                            </div>
                        </div>`;
                });
            }
            
            Swal.fire({
                title: currentEmpData.name,
                html: `
                    <div class="text-start">
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <h6 class="fw-bold">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</h6>
                                    <p class="mb-0">${currentEmpData.nationalId}</p>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <h6 class="fw-bold">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</h6>
                                    <p class="mb-0">${workDays} ÙŠÙˆÙ…</p>
                                </div>
                            </div>
                        </div>
                        
                        ${schedule.length > 0 ? `
                        <div class="mb-3">
                            <h6 class="fw-bold">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„</h6>
                            <div style="max-height: 200px; overflow-y: auto;">
                                ${scheduleHtml}
                            </div>
                        </div>` : ''}
                        
                        <div class="mt-4">
                            <p class="text-muted small"><i class="fas fa-info-circle me-1"></i>Ù„Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„ ÙÙŠ ÙŠÙˆÙ… Ù…Ø¹ÙŠÙ†ØŒ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
                        </div>
                    </div>
                `,
                width: 600,
                showConfirmButton: false,
                showCloseButton: true
            });
        }

        function showSwapDetails(date) {
            if(!currentEmpData) return;
            
            const swap = currentEmpData.schedule.find(s => s.date === date);
            if(!swap) return;
            
            Swal.fire({
                title: 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <h6 class="fw-bold">Ø§Ù„ØªØ§Ø±ÙŠØ®</h6>
                            <p>${date} (${getDayAr(date)})</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="fw-bold">Ø§Ù„Ù†ÙˆØ¹</h6>
                            <p>${swap.isSwapped ? 'ØªØ¨Ø¯ÙŠÙ„' : 'Ù†Ù‚Ù„'}</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="fw-bold">${swap.isSwapped ? 'Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¹' : 'Ø§Ù„Ù†Ù‚Ù„ Ø¥Ù„Ù‰'}</h6>
                            <p>${swap.swappedWith || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                        </div>
                        
                        <div class="mt-4">
                            <p class="text-muted small"><i class="fas fa-info-circle me-1"></i>${swap.isSwapped ? 
                                'Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ù…Ø¹ Ø²Ù…ÙŠÙ„ Ø¢Ø®Ø±' : 
                                'Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ØªÙ… Ù†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ø²Ù…ÙŠÙ„ Ø¢Ø®Ø±'}</p>
                        </div>
                    </div>
                `,
                showConfirmButton: true,
                confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
            });
        }

        function updateNotificationBadge() {
            if(!currentEmpData) return;
            
            const notifications = currentEmpData.notifications || [];
            const unread = notifications.filter(n => !n.read).length;
            const incomingSwaps = allEmployees.reduce((count, emp) => {
                return count + (emp.pendingSwaps || []).filter(p => 
                    p.targetId === currentEmpData.nationalId && p.status === 'pending'
                ).length;
            }, 0);
            
            const totalNotifications = unread + incomingSwaps;
            
            const badge = document.getElementById('notifBadge');
            if(totalNotifications > 0) {
                badge.style.display = 'flex';
                badge.innerText = totalNotifications > 9 ? '9+' : totalNotifications;
            } else {
                badge.style.display = 'none';
            }
        }

        async function showNotifications() {
            if(!currentEmpData) return;
            
            const notifications = currentEmpData.notifications || [];
            const incomingSwaps = [];
            
            allEmployees.forEach(emp => {
                (emp.pendingSwaps || []).forEach(swap => {
                    if(swap.targetId === currentEmpData.nationalId && swap.status === 'pending') {
                        incomingSwaps.push({
                            ...swap,
                            senderName: emp.name,
                            senderId: emp.nationalId
                        });
                    }
                });
            });
            
            let html = '';
            
            if(incomingSwaps.length > 0) {
                html += `<div class="mb-4">
                    <h6 class="fw-bold text-warning mb-3"><i class="fas fa-exchange-alt me-2"></i>Ø·Ù„Ø¨Ø§Øª ØªØ¨Ø¯ÙŠÙ„ ÙˆØ§Ø±Ø¯Ø©</h6>`;
                
                incomingSwaps.forEach(swap => {
                    html += `
                        <div class="border-start border-warning border-3 ps-3 mb-3 py-2">
                            <p class="mb-1"><b>${swap.senderName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</b> ÙŠØ±ÙŠØ¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¹Ùƒ ÙŠÙˆÙ… <b>${swap.myDate}</b></p>
                            ${swap.message ? `<small class="text-muted d-block mb-2">"${swap.message}"</small>` : ''}
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-success btn-sm" onclick="approveSwap('${swap.senderId}', '${swap.requestId}')">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                                <button type="button" class="btn btn-danger btn-sm" onclick="rejectSwap('${swap.senderId}', '${swap.requestId}')">Ø±ÙØ¶</button>
                            </div>
                        </div>`;
                });
                
                html += `</div>`;
            }
            
            if(notifications.length > 0) {
                html += `<div>
                    <h6 class="fw-bold text-primary mb-3"><i class="fas fa-bell me-2"></i>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h6>`;
                
                notifications.slice(0, 5).forEach((notif, index) => {
                    html += `
                        <div class="d-flex justify-content-between align-items-start border-bottom pb-2 mb-2 ${notif.read ? '' : 'fw-bold'}">
                            <div>
                                <p class="mb-1">${notif.message || 'Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¯ÙˆÙ† Ù†Øµ'}</p>
                                <small class="text-muted">${notif.timestamp ? new Date(notif.timestamp).toLocaleString('ar-EG') : 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</small>
                            </div>
                            ${!notif.read ? `<span class="badge bg-primary badge-dot"></span>` : ''}
                        </div>`;
                });
                
                if(notifications.length > 5) {
                    html += `<p class="text-center text-muted small mt-2">Ùˆ ${notifications.length - 5} Ø¥Ø´Ø¹Ø§Ø± Ø¥Ø¶Ø§ÙÙŠ</p>`;
                }
                
                html += `</div>`;
            }
            
            if(html === '') {
                html = '<div class="text-center py-4"><i class="fas fa-bell-slash fa-2x text-muted mb-3"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p></div>';
            }
            
            Swal.fire({
                title: 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª',
                html: html,
                width: 500,
                showCloseButton: true,
                showConfirmButton: false
            });
            
            if(notifications.some(n => !n.read)) {
                const updatedNotifications = notifications.map(n => ({...n, read: true}));
                currentEmpData.notifications = updatedNotifications;
                
                const empIndex = allEmployees.findIndex(e => e.nationalId === currentEmpData.nationalId);
                if (empIndex !== -1) {
                    allEmployees[empIndex].notifications = updatedNotifications;
                    allEmployees[empIndex].lastUpdated = new Date().toISOString();
                }
                
                await saveDataToFirebase();
                
                updateNotificationBadge();
            }
        }

        async function approveSwap(senderId, requestId) {
            Swal.close();
            
            const sender = allEmployees.find(e => e.nationalId === senderId);
            if (!sender) {
                Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ù…Ø±Ø³Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            const request = (sender.pendingSwaps || []).find(r => r.requestId === requestId);
            if (!request) {
                Swal.fire('Ø®Ø·Ø£', 'Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            try {
                const senderIndex = allEmployees.findIndex(e => e.nationalId === senderId);
                const currentEmpIndex = currentEmpData ? allEmployees.findIndex(e => e.nationalId === currentEmpData.nationalId) : -1;
                
                if (senderIndex !== -1) {
                    allEmployees[senderIndex].schedule = allEmployees[senderIndex].schedule.map(s => 
                        s.date === request.myDate ? {...s, wasSwappedOut: true, swappedWith: currentEmpData.name} : s
                    );
                    
                    allEmployees[senderIndex].pendingSwaps = allEmployees[senderIndex].pendingSwaps.map(r => 
                        r.requestId === requestId ? {...r, status: 'completed'} : r
                    );
                    
                    allEmployees[senderIndex].lastUpdated = new Date().toISOString();
                }
                
                if (currentEmpIndex !== -1) {
                    const newSchedule = [...(allEmployees[currentEmpIndex].schedule || [])];
                    newSchedule.push({
                        date: request.myDate,
                        isSwapped: true,
                        swappedWith: sender.name,
                        wasSwappedOut: false
                    });
                    allEmployees[currentEmpIndex].schedule = newSchedule;
                    allEmployees[currentEmpIndex].lastUpdated = new Date().toISOString();
                    
                    if (currentEmpData) {
                        currentEmpData.schedule = newSchedule;
                    }
                }
                
                const saved = await saveDataToFirebase();
                
                if (saved) {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„',
                        text: 'ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„',
                        text: 'ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
                
                if (currentEmpData) {
                    renderEmpUI();
                    updateNotificationBadge();
                }
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ø®Ø±Ù‰ Ø­ØªÙ‰ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØªÙ†Ù‚Ù„ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„Ù‡Ø§
                renderAdminEmps();
                if (typeof renderAdminSwaps === 'function') {
                    try {
                        renderAdminSwaps();
                    } catch (err) {
                        console.error('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', err);
                    }
                }
                if (typeof renderMasterReport === 'function') {
                    try {
                        renderMasterReport();
                    } catch (err) {
                        console.error('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', err);
                    }
                }
                if (typeof renderAssignmentOverview === 'function') {
                    try {
                        renderAssignmentOverview();
                    } catch (err) {
                        console.error('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', err);
                    }
                }
                updateStats();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', error);
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
            }
        }

        async function rejectSwap(senderId, requestId) {
            Swal.close();
            
            try {
                const senderIndex = allEmployees.findIndex(e => e.nationalId === senderId);
                if (senderIndex === -1) {
                    Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ù…Ø±Ø³Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                const request = (allEmployees[senderIndex].pendingSwaps || []).find(r => r.requestId === requestId);
                if (!request) {
                    Swal.fire('Ø®Ø·Ø£', 'Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                allEmployees[senderIndex].pendingSwaps = allEmployees[senderIndex].pendingSwaps.map(r => 
                    r.requestId === requestId ? {...r, status: 'rejected', rejectedAt: new Date().toISOString()} : r
                );
                
                allEmployees[senderIndex].lastUpdated = new Date().toISOString();
                
                const saved = await saveDataToFirebase();
                
                if (saved) {
                    Swal.fire({
                        icon: 'info',
                        title: 'ØªÙ… Ø§Ù„Ø±ÙØ¶',
                        text: 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'info',
                        title: 'ØªÙ… Ø§Ù„Ø±ÙØ¶',
                        text: 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
                
                renderAdminEmps();
                updateStats();
                updateNotificationBadge();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¶:', error);
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨', 'error');
            }
        }

        function renderAdminSwaps() {
            let pendingRequests = [];
            let completedRequests = [];
            
            allEmployees.forEach(employee => {
                (employee.pendingSwaps || []).forEach(request => {
                    const target = allEmployees.find(e => e.nationalId === request.targetId);
                    const requestWithDetails = {
                        ...request,
                        senderName: employee.name,
                        senderId: employee.nationalId,
                        targetName: target ? target.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'
                    };
                    
                    if(request.status === 'completed') {
                        completedRequests.push(requestWithDetails);
                    } else if (request.status === 'pending') {
                        pendingRequests.push(requestWithDetails);
                    }
                });
            });
            
            let pendingHtml = '';
            if(pendingRequests.length > 0) {
                pendingRequests.forEach(req => {
                    pendingHtml += `
                        <div class="request-card status-pending p-3 mb-3 animate__animated animate__fadeIn" 
                             onclick="showSwapRequestDetails('${req.senderId}', '${req.requestId}')">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="d-flex align-items-center mb-1">
                                        <i class="fas fa-user-circle text-primary me-2"></i>
                                        <b>${req.senderName}</b>
                                        <i class="fas fa-arrow-left mx-2 text-muted"></i>
                                        <i class="fas fa-user-circle text-success me-2"></i>
                                        <b>${req.targetName}</b>
                                    </div>
                                    <small class="text-muted">
                                        <i class="fas fa-calendar-day me-1"></i>${req.myDate} (${getDayAr(req.myDate)})
                                    </small>
                                    ${req.message ? `<p class="mt-2 small text-muted">"${req.message}"</p>` : ''}
                                </div>
                                <div>
                                    <span class="badge bg-warning">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>
                                    <button type="button" class="btn btn-sm btn-success mt-2" onclick="event.stopPropagation(); approveSwapAdmin('${req.senderId}', '${req.requestId}')">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger mt-2 ms-1" onclick="event.stopPropagation(); rejectSwapAdmin('${req.senderId}', '${req.requestId}')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-danger mt-2 ms-1" onclick="event.stopPropagation(); deleteSwapAdmin('${req.senderId}', '${req.requestId}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>`;
                });
            } else {
                pendingHtml = '<div class="text-center py-4 text-muted"><i class="fas fa-inbox fa-2x mb-3"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p></div>';
            }
            
            document.getElementById('pendingSwapsList').innerHTML = pendingHtml;
            
            let completedHtml = '';
            if(completedRequests.length > 0) {
                completedRequests.slice(0, 10).forEach(req => {
                    completedHtml += `
                        <div class="request-card status-approved p-3 mb-2" 
                             onclick="showSwapRequestDetails('${req.senderId}', '${req.requestId}')">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted">${req.myDate}</small>
                                    <div class="mt-1">
                                        <b>${req.senderName}</b> <i class="fas fa-arrow-left mx-1 text-muted"></i> <b>${req.targetName}</b>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center gap-1">
                                    <span class="badge bg-success">Ù…ÙƒØªÙ…Ù„</span>
                                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); deleteSwapAdmin('${req.senderId}', '${req.requestId}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>`;
                });
                
                if(completedRequests.length > 10) {
                    completedHtml += `<div class="text-center mt-2">
                        <small class="text-muted">Ùˆ ${completedRequests.length - 10} Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙÙŠ</small>
                    </div>`;
                }
            } else {
                completedHtml = '<div class="text-center py-4 text-muted"><i class="fas fa-check-circle fa-2x mb-3"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</p></div>';
            }
            
            document.getElementById('completedSwapsList').innerHTML = completedHtml;
        }

        function showSwapRequestDetails(senderId, requestId) {
            const sender = allEmployees.find(e => e.nationalId === senderId);
            if(!sender) return;
            
            const request = (sender.pendingSwaps || []).find(r => r.requestId === requestId);
            if(!request) return;
            
            const target = allEmployees.find(e => e.nationalId === request.targetId);
            
            Swal.fire({
                title: 'ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„',
                html: `
                    <div class="text-start">
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <h6 class="fw-bold">Ø§Ù„Ù…Ø±Ø³Ù„</h6>
                                    <p class="mb-1"><i class="fas fa-user me-2"></i>${sender.name}</p>
                                    <small class="text-muted">${sender.nationalId}</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <h6 class="fw-bold">Ø§Ù„Ù…Ø³ØªÙ„Ù…</h6>
                                    <p class="mb-1"><i class="fas fa-user me-2"></i>${target ? target.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                                    <small class="text-muted">${request.targetId}</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="fw-bold">Ø§Ù„ØªØ§Ø±ÙŠØ®</h6>
                            <p><i class="fas fa-calendar me-2"></i>${request.myDate} (${getDayAr(request.myDate)})</p>
                        </div>
                        
                        ${request.message ? `
                        <div class="mb-3">
                            <h6 class="fw-bold">Ø§Ù„Ø±Ø³Ø§Ù„Ø©</h6>
                            <div class="p-3 bg-light rounded">
                                "${request.message}"
                            </div>
                        </div>` : ''}
                        
                        <div class="mb-3">
                            <h6 class="fw-bold">Ø§Ù„Ø­Ø§Ù„Ø©</h6>
                            <span class="badge ${request.status === 'completed' ? 'bg-success' : 
                                                 request.status === 'rejected' ? 'bg-danger' : 'bg-warning'}">
                                ${request.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 
                                 request.status === 'rejected' ? 'Ù…Ø±ÙÙˆØ¶' : 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
                            </span>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</h6>
                            <p>${request.timestamp ? new Date(request.timestamp).toLocaleString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: request.status === 'pending' ? 'Ù…ÙˆØ§ÙÙ‚Ø©' : 'Ø­Ø³Ù†Ø§Ù‹',
                cancelButtonText: 'Ø¥ØºÙ„Ø§Ù‚',
                showDenyButton: request.status === 'pending',
                denyButtonText: 'Ø±ÙØ¶',
                customClass: {
                    confirmButton: 'btn btn-success',
                    denyButton: 'btn btn-danger',
                    cancelButton: 'btn btn-secondary'
                }
            }).then(result => {
                if(result.isConfirmed && request.status === 'pending') {
                    approveSwapAdmin(senderId, requestId);
                } else if(result.isDenied) {
                    rejectSwapAdmin(senderId, requestId);
                }
            });
        }

        async function approveSwapAdmin(senderId, requestId) {
            const sender = allEmployees.find(e => e.nationalId === senderId);
            const request = (sender.pendingSwaps || []).find(r => r.requestId === requestId);
            const target = allEmployees.find(e => e.nationalId === request.targetId);
            
            if(!sender || !request || !target) {
                Swal.fire('Ø®Ø·Ø£', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©', 'error');
                return;
            }
            
            try {
                const senderIndex = allEmployees.findIndex(e => e.nationalId === senderId);
                const targetIndex = allEmployees.findIndex(e => e.nationalId === request.targetId);
                
                if (senderIndex !== -1) {
                    allEmployees[senderIndex].schedule = allEmployees[senderIndex].schedule.map(s => 
                        s.date === request.myDate ? {...s, wasSwappedOut: true, swappedWith: target.name} : s
                    );
                    
                    allEmployees[senderIndex].pendingSwaps = allEmployees[senderIndex].pendingSwaps.map(r => 
                        r.requestId === requestId ? {...r, status: 'completed', approvedAt: new Date().toISOString()} : r
                    );
                    
                    allEmployees[senderIndex].lastUpdated = new Date().toISOString();
                }
                
                if (targetIndex !== -1) {
                    const newSchedule = [...(allEmployees[targetIndex].schedule || [])];
                    newSchedule.push({
                        date: request.myDate,
                        isSwapped: true,
                        swappedWith: sender.name,
                        swappedFrom: sender.nationalId
                    });
                    allEmployees[targetIndex].schedule = newSchedule;
                    allEmployees[targetIndex].lastUpdated = new Date().toISOString();
                }
                
                const saved = await saveDataToFirebase();
                
                if (saved) {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©',
                        text: 'ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'success',
                        title: 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©',
                        text: 'ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
                
                // Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙˆØ±Ø§Ù‹ Ø­ØªÙ‰ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                // Ø¥Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. ÙƒÙ…Ø§ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù…
                // ÙˆØ¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ù„ÙŠØ¹ÙƒØ³Ø§ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©.
                renderAdminEmps();
                renderAdminSwaps();
                updateStats();
                if (typeof renderMasterReport === 'function') {
                    try {
                        renderMasterReport();
                    } catch (err) {
                        console.error('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', err);
                    }
                }
                if (typeof renderAssignmentOverview === 'function') {
                    try {
                        renderAssignmentOverview();
                    } catch (err) {
                        console.error('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', err);
                    }
                }

                if (currentEmpData) {
                    if (currentEmpData.nationalId === senderId) {
                        const updatedSender = allEmployees.find(e => e.nationalId === senderId);
                        if (updatedSender) {
                            currentEmpData.schedule = updatedSender.schedule;
                            renderEmpUI();
                            updateNotificationBadge();
                        }
                    }
                    if (currentEmpData.nationalId === request.targetId) {
                        const updatedTarget = allEmployees.find(e => e.nationalId === request.targetId);
                        if (updatedTarget) {
                            currentEmpData.schedule = updatedTarget.schedule;
                            renderEmpUI();
                            updateNotificationBadge();
                        }
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', error);
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
            }
        }

        async function rejectSwapAdmin(senderId, requestId) {
            try {
                const senderIndex = allEmployees.findIndex(e => e.nationalId === senderId);
                if (senderIndex === -1) {
                    Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ù…Ø±Ø³Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                const request = (allEmployees[senderIndex].pendingSwaps || []).find(r => r.requestId === requestId);
                if (!request) {
                    Swal.fire('Ø®Ø·Ø£', 'Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                allEmployees[senderIndex].pendingSwaps = allEmployees[senderIndex].pendingSwaps.map(r => 
                    r.requestId === requestId ? {...r, status: 'rejected', rejectedAt: new Date().toISOString()} : r
                );
                
                allEmployees[senderIndex].lastUpdated = new Date().toISOString();
                
                const saved = await saveDataToFirebase();
                
                if (saved) {
                    Swal.fire({
                        icon: 'info',
                        title: 'ØªÙ… Ø§Ù„Ø±ÙØ¶',
                        text: 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'info',
                        title: 'ØªÙ… Ø§Ù„Ø±ÙØ¶',
                        text: 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·)',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
                
                renderAdminEmps();
                renderAdminSwaps();
                updateStats();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¶:', error);
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨', 'error');
            }
        }

        // Ø­Ø°Ù Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        async function deleteSwapAdmin(senderId, requestId) {
            Swal.fire({
                title: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù',
                text: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ØŸ',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                confirmButtonColor: '#dc3545'
            }).then(async result => {
                if (result.isConfirmed) {
                    try {
                        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø³Ù„
                        const senderIndex = allEmployees.findIndex(e => e.nationalId === senderId);
                        if (senderIndex !== -1) {
                            allEmployees[senderIndex].pendingSwaps = (allEmployees[senderIndex].pendingSwaps || []).filter(r => r.requestId !== requestId);
                            allEmployees[senderIndex].lastUpdated = new Date().toISOString();
                        }
                        // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù‡ Ø¹Ù„Ø§Ù‚Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨
                        allEmployees.forEach(emp => {
                            if (emp.notifications) {
                                emp.notifications = emp.notifications.filter(n => !(n.requestId && n.requestId === requestId));
                            }
                        });
                        const saved = await saveDataToFirebase();
                        if (saved) {
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù',
                                text: 'ØªÙ… Ø­Ø°Ù Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­',
                                timer: 1500,
                                showConfirmButton: false
                            });
                        } else {
                            Swal.fire({
                                icon: 'success',
                                title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù',
                                text: 'ØªÙ… Ø­Ø°Ù Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·',
                                timer: 1500,
                                showConfirmButton: false
                            });
                        }
                        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
                        if (typeof renderAdminSwaps === 'function') renderAdminSwaps();
                        if (typeof renderAdminEmps === 'function') renderAdminEmps();
                        if (typeof updateStats === 'function') updateStats();
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„:', error);
                        Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø­Ø°Ù Ø·Ù„Ø¨ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„', 'error');
                    }
                }
            });
        }
        function showQuickActions() {
            document.getElementById('quickActionsModal').classList.remove('d-none');
        }

        function hideQuickActions() {
            document.getElementById('quickActionsModal').classList.add('d-none');
        }

        function showHelp() {
            Swal.fire({
                title: 'ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…',
                html: `
                    <div class="text-start">
                        <h6 class="fw-bold text-primary mb-3"><i class="fas fa-search me-2"></i>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¸Ù</h6>
                        <p class="mb-3">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø¨Ø­Ø«" Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„Ù‡.</p>
                        
                        <h6 class="fw-bold text-warning mb-3"><i class="fas fa-exchange-alt me-2"></i>Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„</h6>
                        <p class="mb-3">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø·Ù„Ø¨ ØªØ¨Ø¯ÙŠÙ„" Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„. Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ¨Ø¯ÙŠÙ„Ù‡ØŒ Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ø²Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø­.</p>
                        
                        <h6 class="fw-bold text-success mb-3"><i class="fas fa-bell me-2"></i>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h6>
                        <p class="mb-3">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¬Ø±Ø³ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø£Ùˆ Ø§Ù„Ø±ÙØ¶ Ù…Ù† Ù‡Ù†Ø§Ùƒ.</p>
                        
                        <h6 class="fw-bold text-info mb-3"><i class="fas fa-download me-2"></i>Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„</h6>
                        <p class="mb-0">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©" Ù„ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„Ùƒ ÙƒØµÙˆØ±Ø© ÙŠÙ…ÙƒÙ† Ø·Ø¨Ø§Ø¹ØªÙ‡Ø§ Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§.</p>
                    </div>
                `,
                width: 600,
                showConfirmButton: true,
                confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
            });
        }

        async function refreshSwaps() {
            await loadData();
            renderAdminSwaps();
            Swal.fire({
                icon: 'success',
                title: 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«',
                timer: 1000,
                showConfirmButton: false
            });
        }

        function exportSwaps() {
            let swapsData = [];
            
            allEmployees.forEach(emp => {
                (emp.pendingSwaps || []).forEach(swap => {
                    if(swap.status === 'completed') {
                        swapsData.push({
                            'Ø§Ù„Ù…Ø±Ø³Ù„': emp.name,
                            'Ø§Ù„Ù…Ø³ØªÙ„Ù…': swap.targetName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                            'Ø§Ù„ØªØ§Ø±ÙŠØ®': swap.myDate,
                            'Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨': 'Ù…ÙƒØªÙ…Ù„',
                            'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨': swap.timestamp ? new Date(swap.timestamp).toLocaleDateString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'
                        });
                    }
                });
            });
            
            if(swapsData.length === 0) {
                Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© Ù„Ù„ØªØµØ¯ÙŠØ±', 'info');
                return;
            }
            
            try {
                const ws = XLSX.utils.json_to_sheet(swapsData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ¨Ø¯ÙŠÙ„');
                
                const fileName = `Ø·Ù„Ø¨Ø§Øª_Ø§Ù„ØªØ¨Ø¯ÙŠÙ„_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                Swal.fire({
                    icon: 'success',
                    title: 'ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±',
                    text: 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­',
                    timer: 1500,
                    showConfirmButton: false
                });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
                Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù', 'error');
            }
        }

        window.onload = function() {
            init();
            
            setTimeout(() => {
                document.querySelectorAll('.animate-on-load').forEach((el, index) => {
                    el.style.animationDelay = `${index * 0.1}s`;
                });
            }, 100);
            
            document.addEventListener('click', function(event) {
                const quickActions = document.getElementById('quickActionsModal');
                const fab = document.querySelector('.floating-action-btn');
                
                if (quickActions && fab) {
                    if(!quickActions.contains(event.target) && !fab.contains(event.target)) {
                        hideQuickActions();
                    }
                }
            });
            
            document.getElementById('nidInput').addEventListener('keypress', function(e) {
                if(e.key === 'Enter') {
                    searchEmployee();
                }
            });
            
            document.getElementById('adminPass').addEventListener('keypress', function(e) {
                if(e.key === 'Enter') {
                    checkAdmin();
                }
            });
            
            setTimeout(() => {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if(loadingOverlay && loadingOverlay.style.display !== 'none') {
                    console.log('ğŸ• ØªÙ… ØªØ¬Ø§ÙˆØ² Ù…Ù‡Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ - Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©');
                    loadingOverlay.style.display = 'none';
                    document.getElementById('userInterface').style.display = 'block';
                    
                    loadMockData();
                }
            }, 5000);
        };

        window.onbeforeprint = function() {
            const footer = document.querySelector('.designer-footer');
            if(footer) footer.style.display = 'block';
        };
        
        window.onafterprint = function() {
            const footer = document.querySelector('.designer-footer');
            if(footer) footer.style.display = 'none';
        };
</script>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø´ÙƒØ± Ø§Ù„Ù…ØªØ­Ø±Ùƒ - ÙŠØ¸Ù‡Ø± ÙÙŠ ÙƒÙ„ Ø§Ù„Ø´Ø§Ø´Ø§Øª ÙˆÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div class="thank-you-banner">
        <span>Ø´ÙƒØ± Ø®Ø§Øµ Ù„Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¨ÙˆÙ„Ø³ Ø³Ù…ÙŠØ±ØŒ Ù…Ø¯ÙŠØ± ÙˆØ­Ø¯Ø© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨ÙƒÙ„ÙŠØ© Ø§Ù„Ø·Ø¨ Ø§Ù„Ø¨ÙŠØ·Ø±ÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù†ÙŠØ§</span>
    </div>

</body>
</html>